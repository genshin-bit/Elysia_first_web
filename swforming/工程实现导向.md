# 工程实现导向（产品体系 + 新闻体系）

基于 `e:\phpstudy_pro\WWW\wp-content\themes\swforming\全站模块分析.md` 的模块清单（重点：`card-product`、`breadcrumbs`、`pagination`、`card-post`、`toc`、`share-buttons`、`post-navigation`），按“页面 → 模块 → 模板 → 调用方式”给出迁移落地方案。

## 1. 页面类型映射确认（不新增页面）

### 1.1 产品体系（WooCommerce）

- 产品分类页（`product_cat` taxonomy）→ `taxonomy-product_cat.php`
- 产品详情页（single product）→ `woocommerce/single-product.php`
- 不引入：`archive-product.php` / Shop 页面 / 产品归档页

### 1.2 新闻体系（Blog）

- 新闻列表页（Blog Index）→ `home.php`（优先）或 `index.php`
- 新闻详情页（single post）→ `single.php`（post）

## 2. A. 产品相关页面（分类页 + 详情页）

### 2.1 产品分类页（taxonomy: `product_cat`）

#### 模块清单 → 模板 → 调用方式

| 模块 | 类型 | 承载模板 | 调用方式 |
|---|---|---|---|
| `site-header` | 全站公共 | `header.php` + `template-parts/layout/site-header.php` | `get_header()` 内部 `get_template_part()` |
| `overlay-search-modal` | 全站公共 | `template-parts/components/overlay-search-modal.php` | `header.php` 内 `get_template_part()` |
| `panel-offcanvas-menu` | 全站公共 | `template-parts/components/panel-offcanvas-menu.php` | `header.php` 内 `get_template_part()` |
| `breadcrumbs` | 跨页面复用 | `template-parts/components/breadcrumbs.php` | `taxonomy-product_cat.php` 内 `get_template_part()` 或挂入 `woocommerce_before_main_content` |
| `page-hero-title`（可选） | 跨页面复用 | `template-parts/components/page-hero-title.php` | `taxonomy-product_cat.php` 内 `get_template_part()`（若分类页需要首屏标题区） |
| `woo-archive-result-count` | 页面私有（产品分类页） | `template-parts/components/woo-archive-result-count.php` | 通过 Hook：保留 `woocommerce_result_count()`，或模板内显式调用 |
| `loop-product-grid`（产品卡片列表容器） | 页面私有（分类页） | `taxonomy-product_cat.php` | 使用 Woo loop：`woocommerce_product_loop_start()` / `wc_get_template_part('content','product')` / `woocommerce_product_loop_end()` |
| `card-product`（单个产品卡） | 跨页面复用 | `template-parts/loop/card-product.php` 或 Woo 标准 `content-product.php` | 方案一：不新增 Woo override，沿用 Woo 的 `content-product.php`；方案二：用 Hook 改写循环输出时调用 `get_template_part()` |
| `pagination` | 跨页面复用 | `template-parts/components/pagination.php` | 分类页使用 `woocommerce_pagination()`，或模板内统一封装为 `pagination` 模块 |
| `popup-product-inquiry` | 页面私有（产品相关） | `template-parts/components/popup-product-inquiry.php` | 挂到 `wp_footer` 或 `footer.php` 内条件渲染（仅产品相关模板加载） |
| `popup-catalog-download` | 全站公共 | `template-parts/components/popup-catalog-download.php` | `footer.php` 内 `get_template_part()` |
| `site-footer` | 全站公共 | `footer.php` + `template-parts/layout/site-footer.php` | `get_footer()` 内部 `get_template_part()` |

#### 模块复用边界

- 页面私有：`woo-archive-result-count`、`loop-product-grid`（分类语境下的列表容器）、`popup-product-inquiry`（产品语境）
- 跨页面复用：`breadcrumbs`、`pagination`、`card-product`、`page-hero-title`（若启用）

#### Hook 策略（最小化且不引入冗余）

- 目标：分类页只承担“某个 `product_cat` 下的产品卡片列表”，不引入 Shop 语义。
- 建议：在 `taxonomy-product_cat.php` 中控制页面骨架；Woo 的 loop 与分页仍用原生函数，以减少复制 Woo 模板。
- 若需要统一容器/标题区：用 `remove_action` / `add_action` 调整 `woocommerce_before_main_content`、`woocommerce_after_main_content` 的 wrapper 与 breadcrumbs 输出位置。

### 2.2 产品详情页（Woo Single Product）

#### 模块清单 → 模板 → 调用方式

| 模块 | 类型 | 承载模板 | 调用方式 |
|---|---|---|---|
| `site-header` / `overlay-search-modal` / `panel-offcanvas-menu` | 全站公共 | `header.php` | `get_header()` |
| `breadcrumbs` | 跨页面复用 | `template-parts/components/breadcrumbs.php` | Woo 默认 `woocommerce_breadcrumb()`；或替换为主题模块以统一样式 |
| `product-gallery` | 页面私有（单品） | Woo 区域 | 保留 Woo：`woocommerce_show_product_images()`，必要时在 `woocommerce_before_single_product_summary` 调整排序/包裹 |
| `product-summary`（标题/价格/短描述/CTA） | 页面私有（单品） | Woo 区域 | 保留 Woo：`woocommerce_single_product_summary` 上的默认 hook 组合 |
| `product-tabs` | 页面私有（单品） | Woo 区域 | 保留 Woo：`woocommerce_output_product_data_tabs()` |
| `toc` | 跨页面复用 | `template-parts/components/toc.php` | 仅当产品详情存在 TOC 结构时挂载；不在分类页加载 |
| `share-buttons` | 跨页面复用 | `template-parts/components/share-buttons.php` | 以模块形式插入到 summary 之后或 tabs 之后（Hook：`woocommerce_after_single_product_summary`） |
| `related-products`（相关产品容器） | 页面私有（单品） | Woo 区域 | 保留 Woo：`woocommerce_output_related_products()`；其内部复用 `card-product` |
| `card-product` | 跨页面复用 | 同上 | 通过 Woo loop 或统一卡片组件渲染 |
| `popup-product-inquiry` | 页面私有（产品相关） | `template-parts/components/popup-product-inquiry.php` | 条件加载（仅 `is_product()`） |
| `popup-catalog-download` / `site-footer` | 全站公共 | `footer.php` | `get_footer()` |

#### 模块复用边界

- 页面私有：`product-gallery`、`product-summary`、`product-tabs`、`related-products` 容器、`popup-product-inquiry`
- 跨页面复用：`breadcrumbs`、`toc`、`share-buttons`、`card-product`

#### Hook 策略（控制点）

- 优先保留 Woo 默认的 `single-product` hook 流程，减少模板复制。
- 只在需要“插入模块/调整顺序”时动 Hook：例如把 `share-buttons` 插到 tabs 后、把 `toc` 插到内容主体前。

## 3. B. 新闻相关页面（列表页 + 详情页）

### 3.1 Blog 列表页（Blog Index）

#### 模块清单 → 模板 → 调用方式

| 模块 | 类型 | 承载模板 | 调用方式 |
|---|---|---|---|
| `site-header` / `overlay-search-modal` / `panel-offcanvas-menu` | 全站公共 | `header.php` | `get_header()` |
| `page-hero-title`（建议） | 跨页面复用 | `template-parts/components/page-hero-title.php` | `home.php` 内 `get_template_part()` |
| `breadcrumbs`（可选） | 跨页面复用 | `template-parts/components/breadcrumbs.php` | 若站点信息架构要求 Blog 也展示路径则启用 |
| `loop-post-grid`（文章列表容器） | 页面私有（Blog 列表） | `home.php` | `WP_Query` / 主循环输出容器 |
| `card-post`（文章卡片） | 跨页面复用 | `template-parts/loop/card-post.php` | 循环内 `get_template_part('template-parts/loop/card-post')` |
| `pagination` | 跨页面复用 | `template-parts/components/pagination.php` | 使用 `the_posts_pagination()` / `paginate_links()` |
| `share-buttons`（按需） | 跨页面复用 | `template-parts/components/share-buttons.php` | 列表页若确实存在“分享组件块”则作为可选模块挂载 |
| `popup-catalog-download` / `site-footer` | 全站公共 | `footer.php` | `get_footer()` |

#### Blog 列表页：是否需要 Page Hero / 面包屑（工程口径）

- `page-hero-title`：建议启用（用于统一列表页首屏高度与标题样式，避免多模板重复写标题区）。
- `breadcrumbs`：可选（若站点仅在产品路径强调层级，则 Blog 可不展示以减少噪音；若 SEO/UX 需要统一，则启用）。

### 3.2 Blog 详情页（single post）

#### 模块清单 → 模板 → 调用方式

| 模块 | 类型 | 承载模板 | 调用方式 |
|---|---|---|---|
| `site-header` / `overlay-search-modal` / `panel-offcanvas-menu` | 全站公共 | `header.php` | `get_header()` |
| `page-hero-title`（建议） | 跨页面复用 | `template-parts/components/page-hero-title.php` | `single.php` 内 `get_template_part()`（显示文章标题/时间/分类等） |
| `breadcrumbs`（可选） | 跨页面复用 | `template-parts/components/breadcrumbs.php` | 若启用则挂在 hero 下或正文上方 |
| `post-content`（内容主体） | 页面私有（文章） | `single.php` | 主循环：标题、meta、正文、特色图等 |
| `toc` | 跨页面复用 | `template-parts/components/toc.php` | `single.php` 内条件渲染（仅当文章存在结构化标题时） |
| `share-buttons` | 跨页面复用 | `template-parts/components/share-buttons.php` | 正文末尾或侧栏区域 |
| `post-navigation`（上一篇/下一篇） | 跨页面复用 | `template-parts/components/post-navigation.php` | `the_post_navigation()` 或自定义输出 |
| `related-posts`（如有） | 页面私有（文章） | `single.php` | 若存在“推荐文章”区域，内部复用 `card-post` |
| `card-post` | 跨页面复用 | `template-parts/loop/card-post.php` | 相关列表循环内复用 |
| `popup-catalog-download` / `site-footer` | 全站公共 | `footer.php` | `get_footer()` |

## 4. 主题结构建议（正确且不引入冗余）

目标：只覆盖本项目需要的页面类型；页面级逻辑只放在主模板；`template-parts` 只承载模块，不复制页面流程。

- 根模板（页面级）
  - `header.php`
  - `footer.php`
  - `index.php`（兜底，不承载 Blog 列表的主要逻辑）
  - `home.php`（Blog Index）
  - `single.php`（single post）
  - `taxonomy-product_cat.php`（产品分类页）
- WooCommerce（仅保留必需）
  - `woocommerce/single-product.php`
- template-parts（模块级，不重复页面逻辑）
  - `template-parts/layout/site-header.php`
  - `template-parts/layout/site-footer.php`
  - `template-parts/components/overlay-search-modal.php`
  - `template-parts/components/panel-offcanvas-menu.php`
  - `template-parts/components/popup-catalog-download.php`
  - `template-parts/components/popup-product-inquiry.php`
  - `template-parts/components/breadcrumbs.php`
  - `template-parts/components/pagination.php`
  - `template-parts/components/page-hero-title.php`
  - `template-parts/components/toc.php`
  - `template-parts/components/share-buttons.php`
  - `template-parts/components/post-navigation.php`
  - `template-parts/loop/card-product.php`
  - `template-parts/loop/card-post.php`

明确不包含：

- `archive-product.php`（本项目不使用 Shop/产品归档）
- `archive.php`（除非后续要支持分类/标签/日期归档的 Blog 扩展；当前需求未要求）
- Solution 体系相关模板（`全站模块分析.md` 中存在静态 Solution 页面，但不在本次约束的迁移范围内）

## 5. 本项目常见迁移误区（需要规避）

- 把产品分类页当成 Shop（导致引入 `archive-product.php`、shop 页、错误的导航语义与 SEO 路由）。
- 在分类页写死产品 HTML（如首页当前 `section-product-grid.php` 的硬编码模式会造成数据不一致、价格/库存/上下架不同步）。
- 在多个模板复制产品卡片结构（应收敛到 `card-product` 或 Woo 标准 `content-product`，否则 hover/按钮/徽章多处漂移）。
- 为了“统一结构”过度 override Woo 模板（本项目只需要分类页 + 单品页，优先用 Hook 调整而不是复制整套 Woo 模板树）。
- Blog 与（静态站里存在的）Solution 混用 Loop（会导致查询条件、分页、面包屑语义相互污染；本次迁移范围只落地 Blog）。
- 把 TOC/Share/Navigation 写进多个页面模板而不模块化（后续样式与平台配置变更会产生全站多点维护）。

