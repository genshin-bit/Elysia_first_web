# 关于我们页面动态化方案（ACF + WordPress 原生）

仅依赖 ACF 插件和 WordPress 原生能力，不引入其他插件。在保持现有模块化拆分和样式完全不变的前提下，通过 ACF 字段驱动 About Us 页面内容动态化，并兼顾组件复用与跨页面联动。

关联文件：

- 页面模板：[page-about-us.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/page-about-us.php)
- 相关模块：
  - [template-parts/components/page-hero-title.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/components/page-hero-title.php)
  - [template-parts/one_page/section-about-company-intro.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/one_page/section-about-company-intro.php)
  - [template-parts/one_page/section-about-capabilities.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/one_page/section-about-capabilities.php)
  - [template-parts/one_page/section-about-mission-gold-rd.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/one_page/section-about-mission-gold-rd.php)

---

## 一、整体思路

- 保持当前页面骨架和模块拆分不变：
  - `page-about-us.php` 内只负责 `<main>/<article>/.entry-content/.elementor` 骨架以及模块编排：

    ```php
    <div data-elementor-type="wp-page" data-elementor-id="188" class="elementor elementor-188" data-elementor-post-type="page">
        <?php
        get_template_part('template-parts/components/page-hero-title');
        get_template_part('template-parts/one_page/section-about-company-intro');
        get_template_part('template-parts/one_page/section-about-capabilities');
        get_template_part('template-parts/one_page/section-about-mission-gold-rd');
        ?>
    </div>
    ```

  - 各 `section-about-*` 模块只输出自身顶级 `<section>`，不再包含 `<main>` 等骨架。

- 通过 ACF 定义字段层：
  - 部分字段挂在页面级（About 页面本身），支持不同语言/分站的差异；
  - 部分高度通用的内容（例如品牌使命）挂在 Options Page，全站复用。

- 模板中使用 `get_field()` / `get_fields()` 读取 ACF 字段，并提供「无字段时退回当前硬编码内容」的 fallback，保证改造过程平滑无风险。

- 弹窗、统计、脚本加载仍依赖现有 Elementor/Blocksy/WooCommerce 结构，不做插件层面的变动。

---

## 二、字段分层与复用策略

### 1. Page Hero 标题区（全站通用组件）

对应组件：`template-parts/components/page-hero-title.php`，已在多个单页中使用（About / Why Us / Factory / Social Responsibility / FAQ / Contact 等）。

**字段归属策略**

- 页面级：允许每个页面覆盖标题、副标题、背景图等；
- Options（全局级）：提供全站默认值（例如通用副标题或通用背景图）。

**ACF 字段组建议**

字段组：`Page Hero 通用配置`

- 位置规则：
  - 条件 A：Post Type = Page（页面级）
  - 条件 B：Options Page = Theme Global Settings（全局默认）

- 字段示例：
  - `hero_title`（文本）
    - 页面级：About Us 用于覆盖「About Us」标题，其他页面可设置自定义标题；
    - Options 级：设置全局默认标题；当页面未设置时使用；
    - 若两处都为空，模板 fallback 为 `the_title()`。
  - `hero_subtitle`（文本 / 文本域）
    - 可在 About / Factory / 社会责任等页面展示一句副标题；
    - 未设置则不输出对应 DOM。
  - `hero_background_image`（图片）
    - 页面级：为单一页面设置特殊背景；
    - Options 级：设置全站默认 hero 背景；
    - 均为空时，保持原有无背景或原有硬编码背景。

**读取逻辑（示意）**

```php
$hero_title        = get_field('hero_title');                  // 页面级
$hero_title_global = get_field('hero_title', 'option');        // 全局

if (!$hero_title) {
    $hero_title = $hero_title_global ?: get_the_title();
}

$hero_subtitle        = get_field('hero_subtitle');
$hero_subtitle_global = get_field('hero_subtitle', 'option');

if (!$hero_subtitle) {
    $hero_subtitle = $hero_subtitle_global;
}

$hero_bg        = get_field('hero_background_image');
$hero_bg_global = get_field('hero_background_image', 'option');
$hero_bg        = $hero_bg ?: $hero_bg_global;
```

**跨页面联动**

- 所有使用 `page-hero-title` 的页面共用同一套字段名；
- 每个页面可按需单独覆盖 hero 文案/图片，未覆盖时统一走全局默认；
- 可在 Options Page 中统一调整整站的 hero 副标题或背景风格。

---

### 2. 公司介绍区（section-about-company-intro）

模板文件：`template-parts/one_page/section-about-company-intro.php`

结构：左侧公司形象图，右侧「About SUNWAY」副标题、主标题、两段公司介绍，以及 CONTACT US 按钮（通过 Popup ID=306 触发联系弹窗）。

**字段归属策略**

- 以 About 页页面级字段为主；
- 未来可将核心介绍文案同步到 Options 级字段，供首页或 Factory 页面复用。

**ACF 字段组建议**

字段组：`About - 公司介绍`

- 位置规则：Post Type = Page，且模板 = 关于我们（或指定 Page ID=188）

- 字段：
  - `about_intro_badge`（文本）
    - 默认值：`About SUNWAY`
  - `about_intro_title`（文本）
    - 默认值：`Professional manufacturer and exporter of cold-forming machinery`
  - `about_intro_paragraphs`（Repeater）
    - 子字段 `text`（WYSIWYG 或 Textarea）
    - 初始填充两条，分别对应当前两段介绍文本；支持未来增减段落。
  - `about_intro_image`（图片）
    - 替代当前固定图片 `240702111754-1-1024x576.jpg`。
  - `about_intro_link_type`（选择）
    - 选项：`popup` / `page`
    - 默认：`popup`（沿用现有弹窗方式）。
  - 当 `about_intro_link_type = popup`：
    - `about_intro_popup_id`（数字）
      - 默认：`306`（与当前 Elementer 弹窗 ID 一致，用于生成 href）。
  - 当 `about_intro_link_type = page`：
    - `about_intro_cta_url`（URL）
    - `about_intro_cta_label`（文本，默认 `CONTACT US`）

**模板逻辑要点**

- 文案、图片：
  - 优先读 ACF 字段；
  - 如果字段为空，退回当前硬编码 HTML 中的默认值。

- CTA 按钮：
  - 若 `link_type = popup`，继续输出 `href="#elementor-action:action=popup:open&...id=<about_intro_popup_id>"`，保证与 `shared-contact-popup` 弹窗联动；
  - 若 `link_type = page`，输出普通 URL 链接按钮，用于未来改版时跳转到 Contact 页面。

**潜在复用**

- 可在 Options Page 中增加一组 `global_about_intro_*` 字段，用于首页或 Factory 页的企业介绍模块；
- About 页仍以页面级字段为主，读取逻辑为：页面级 > 全局级 > 硬编码默认。

---

### 3. Our Capabilities + 工厂引流区（section-about-capabilities）

模板文件：`template-parts/one_page/section-about-capabilities.php`

结构：左侧「Our Capabilities」标题 + 主标题 + 文案 + “Step into our factory” 按钮；右侧两张叠加工厂图片。

**字段归属策略**

- 页面级字段为主；
- 与 Factory 页面建立链接，避免写死 URL；
- 工厂图片可与 Factory 页的图片保持一致（可通过 Options 或 Factory 页字段复用）。

**ACF 字段组建议**

字段组：`About - 能力与工厂 CTA`

- 位置规则：Post Type = Page，模板 = 关于我们

- 字段：
  - `capabilities_badge`（文本）
    - 默认：`Our Capabilities`
  - `capabilities_title`（文本）
    - 默认：`We Meet timeliness and quality requirements`
  - `capabilities_description`（WYSIWYG）
    - 默认填当前长段文字。
  - `capabilities_cta_label`（文本）
    - 默认：`Step into our factory`
  - `capabilities_cta_target`（Post Object 或 Relationship，目标类型 = Page）
    - 用于选择真正的工厂页面；
    - 模板使用 `get_permalink( $capabilities_cta_target )` 生成链接；
    - 未设置时 fallback 为现有静态链接 `index-6.html`。
  - `capabilities_main_image`（图片）
  - `capabilities_secondary_image`（图片）

**跨页面联动**

- 与 Factory 页联动：
  - 在 Factory 页面模板中可以增加标识字段（如 `is_factory_page`）或直接依赖固定模板；
  - About 页在 `capabilities_cta_target` 中选择该 Factory 页面，按钮自动跳转至该页。

- 与首页或其他页面：
  - 如首页需要展示“能力介绍”模块，可以通过 Options Page 定义一套 `capabilities_*` 全局字段；
  - About 页字段为空时可选择回退到 Options 中的全局能力配置。

---

### 4. Our Mission / Our Gold / R & D 三列使命区（section-about-mission-gold-rd）

模板文件：`template-parts/one_page/section-about-mission-gold-rd.php`

结构：背景 Slideshow + 三列卡片，分别为 01 Our mission / 02 Our Gold / 03 R & D，每列内容带 `zoomIn` 动画。

**字段归属策略**

- 推荐以 Options 级字段存储品牌使命内容（全站共用）；
- About 页面可以有一套覆盖字段（可选，如不同语言版本希望差异化）。

**ACF 字段组建议**

字段组 A：`Global - 品牌使命 / 目标 / 研发`

- 位置规则：Options Page = Theme Global Settings

- 字段：
  - `mission_background_slides`（Repeater）
    - 子字段：`image`（图片）
    - 对应当前 `data-settings` 中 `background_slideshow_gallery` 的两个 URL 列表。
  - `mission_items`（Repeater，最小 3 条）
    - 子字段：
      - `index`（文本），如 `01` / `02` / `03`
      - `title`（文本），如 `Our mission`
      - `description`（WYSIWYG），对应三段长文
      - `animation`（选择，默认 `zoomIn`，可选 `none`）

字段组 B：`About - 使命区覆盖（可选）`

- 位置规则：关于我们页面
- 字段结构同 `mission_items`，用于对全局内容进行覆盖。

**模板读取逻辑**

```php
$local_items  = get_field('about_mission_items');        // 页面级
$global_items = get_field('mission_items', 'option');    // 全局
$items        = $local_items ?: $global_items;

// 背景 slides
$local_slides  = get_field('about_mission_background_slides');
$global_slides = get_field('mission_background_slides', 'option');
$slides        = $local_slides ?: $global_slides;
```

循环输出时：

- 根据 `index`、`title`、`description` 渲染对应 DOM；
- 若 `animation` = `zoomIn`，则输出当前模板已有的动画 class 和 `data-settings`；否则省略这些属性。

**跨页面复用场景**

- 社会责任页可以新增一个模块直接使用 `mission_items` options 字段，展示公司使命与价值观；
- 若某页面只想展示其中一列（如只展示 “Our mission”），可在模板层对 `$items` 做子集取值；
- 当品牌策略调整，只需在后台 Options 页面更新 `mission_items` 文案即可，所有引用页面同步更新。

---

## 三、ACF 与 WordPress 原生能力的配合

### 1. Options Page 配置

在主题 `functions.php` 中添加 Options Page，用于存放全局 Hero 和 Brand Mission 等配置：

```php
if (function_exists('acf_add_options_page')) {
    acf_add_options_page(array(
        'page_title' => 'Theme Global Settings',
        'menu_title' => 'Theme Settings',
        'menu_slug'  => 'theme-global-settings',
        'capability' => 'edit_posts',
        'redirect'   => false,
    ));
}
```

之后在 ACF 后台为该 Options Page 绑定：

- `Page Hero 通用配置`
- `Global - 品牌使命 / 目标 / 研发`
- 可选的 `Global - 公司介绍` 等字段组。

### 2. WordPress 原生函数使用

- `the_title()` / `get_the_title()`：作为 Hero 标题的最终 fallback；
- `get_the_ID()`：在 Hero 区判断当前页面；
- `get_permalink()`：用于从 `capabilities_cta_target`（Post Object）生成工厂页链接；
- 分类和自定义 Post Type 不参与本页面逻辑，About 页仍作为一个普通 Page 处理。

---

## 四、组件复用与跨页面联动总览

**全局组件（components）**

- `page-hero-title`
  - 通用 Hero 标题区，所有单页共用；
  - ACF 字段：`hero_*`，支持页面级与 Options 级；
  - 保证不同单页在视觉上统一，同时允许局部差异。

- `popup-product-inquiry` / `popup-catalog-download`
  - 已在 Footer 中统一输出，按钮通过 `href="#elementor-action:action=popup:open&settings=..."` 触发；
  - About 公司介绍区按钮只负责触发，不直接内嵌表单。

**单页模块（one_page）**

- `section-about-company-intro`
  - ACF：`about_intro_*` 页面级字段；
  - 可被首页或 Factory 页的公司介绍模块通过 Options 字段间接复用文案。

- `section-about-capabilities`
  - ACF：`capabilities_*` 页面级字段；
  - 通过 `capabilities_cta_target` 联动到 Factory 页面；
  - 图片和文案也可在 Options 中统一配置，为其他页面提供能力介绍基础数据。

- `section-about-mission-gold-rd`
  - ACF：Options 级 `mission_items` / `mission_background_slides`，About 页可用 `about_mission_items` 覆盖；
  - 社会责任等页面可新增模块直接使用这组 Brand Mission 数据，实现站内统一。

---

## 五、实施顺序建议

1. 在 ACF 中创建上述字段组和 Options Page，仅配置字段，不改代码；
2. 先改 `page-hero-title`，接入 `hero_*` 字段并做好 fallback，不影响现有显示；
3. 分别改造：
   - `section-about-company-intro` 接入 `about_intro_*`
   - `section-about-capabilities` 接入 `capabilities_*`
   - `section-about-mission-gold-rd` 接入 `mission_*`（Options）和 `about_mission_*`（覆盖）
4. 在后台为 About 页与 Options 页填写数据，确认前后视觉一致；
5. 最后视需要在首页 / Factory / 社会责任等页面复用 Options 字段，实现跨页面联动。

