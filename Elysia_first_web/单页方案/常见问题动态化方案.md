# 常见问题页面动态化方案（基于 ACF 与 WordPress 原生能力）

## 一、目标与原则

- 保持 FAQ 页面现有样式与前端结构不变，仅替换为动态数据输出  
- 只使用 ACF 插件与 WordPress 原生能力（Page、Options、媒体库等），不引入其他插件  
- 复用已有通用组件（`page-hero-title`、全局 CTA/联系入口），避免重复开发  
- 设计「全局默认 + 页面级覆盖」两层字段结构，方便统一运营与多语言扩展  
- 预留与其他页面（产品页、关于我们、联系我们等）的联动能力

---

## 二、涉及模板与模块梳理

### 2.1 页面与主模板

- 页面模板：`[page-faq.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/page-faq.php)`  
- 页面来源：`index-10.html`（FAQ，single_page 类型）

当前主模板结构（摘要）：

- 头部 `<link>/<script>`：保留在 `page-faq.php` 中，不做模块化  
- 主内容 `<main>` 内：
  - 包裹元素：`.ct-container-full` → `<article id="post-294">` → `.entry-content` → `.elementor.elementor-294`
  - 内部通过：
    - `template-parts/components/page-hero-title.php`：首屏 Hero 标题（FAQ）
    - `template-parts/one_page/faq-intro.php`：左侧引导文案区 + 联系按钮
    - `template-parts/one_page/faq-accordion.php`：右侧 FAQ 折叠内容

### 2.2 FAQ 页面相关模块

1. 首屏 Hero 区（全站复用）
   - 组件：`[page-hero-title.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/components/page-hero-title.php)`  
   - 功能：输出当前单页的 H1 标题（FAQ），统一普通单页的 Hero 样式/高度  
   - 在《关于我们动态化方案》中已定义为全站通用 hero 组件

2. FAQ 引导文案区（页面私有 + 可局部复用）
   - 模板：`[faq-intro.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/one_page/faq-intro.php)`  
   - 功能：
     - 左侧标题「We welcome question!」  
     - 一段引导说明文案  
     - 「CONTACT US NOW→」按钮（当前硬编码外链 `https://easyceo.site/contact/`）
   - 右侧列内引入 `faq-accordion.php`

3. FAQ 折叠问答区（页面私有 + 可抽象为全站 FAQ 组件）
   - 模板：`[faq-accordion.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/one_page/faq-accordion.php)`  
   - 功能：
     - 使用 EAEL Advanced Accordion 输出 7 条问答  
     - 每条问答结构为 `.eael-accordion-list` 内部包含：
       - `.elementor-tab-title.eael-accordion-header`（问题）
       - `.eael-accordion-content`（回答）
     - 通过 `id`、`data-tab`、`aria-*` 属性实现展开/收起

---

## 三、整体动态化设计思路

### 3.1 字段分层：全局默认 + 页面级覆盖

1. 全局层（Options Page）
   - 定义「FAQ 全局设置」，包括：
     - 默认 FAQ Intro 文案/按钮  
     - 默认 FAQ 列表（问题/答案）  
     - FAQ 页面引用（方便其他页面链接到 FAQ 页）  
   - 适合不会频繁变化、可被多个页面引用的内容

2. 页面层（FAQ 页面编辑页）
   - 在 FAQ 单页上挂载「常见问题页面设置」字段组  
   - 页面级字段存在时优先使用；为空时回退到全局默认  
   - 方便未来如有「产品专属 FAQ 页面」时按页面单独配置

### 3.2 模块级复用策略

- Hero 区 `page-hero-title`：
  - 复用已在「关于我们」「工厂」等方案中规划的通用 Hero 字段（`hero_title`、`hero_subtitle` 等）  
  - FAQ 页面可单独设置 Hero 标题/副标题，否则回退到全局默认或 `the_title()`

- FAQ Intro 文案模块：
  - 当前为 FAQ 页面私有，但其「引导文案 + 联系按钮」模式具有共性  
  - 通过 ACF 字段抽象为「FAQ 引导模块」，将来可以在产品页或联系我们页复用类似结构

- FAQ Accordion 问答模块：
  - 使用 Repeater 字段驱动问题/答案列表  
  - 后续其他页面如需展示部分 FAQ，可复用同一数据源（全局默认）并限制显示条数

### 3.3 与其他页面的联动

1. 跳转至 FAQ 页面
   - 在 Options 中维护一个 `faq_page_ref` 字段（Post Object）指向 FAQ 页面  
   - 其他页面（如产品页、质量制造、Why Us）如需展示「查看更多 FAQ」按钮时，不再硬编码 `/faq/`，而是从该字段读取链接

2. 联系我们 CTA 统一
   - FAQ Intro 中的「CONTACT US NOW→」按钮不再硬编码为外部链接  
   - 改为从全局「联系页面引用」或「联系 URL」字段读取：  
     - 如已在其他方案中定义 `contact_page_ref`，则 FAQ Intro 复用该字段  
     - 若尚未定义，可以在本方案中补充一个全局字段

3. FAQ 片段复用
   - 可以在首页、产品详情页等位置展示前 N 条常见问题：  
     - 使用全局 FAQ Repeater 字段  
     - 按顺序或通过布尔字段 `is_featured` 标记精选问答

---

## 四、ACF 字段设计（全局 Options）

在 ACF 中创建或扩展一个 Options Page（如「网站全局设置」），增加「FAQ 全局设置」字段组。

### 4.1 字段组：FAQ 全局设置（global_faq_settings）

- 位置：Options Page（例如 `theme-general-settings`）

字段建议：

1. FAQ 页面引用
   - 字段名：`faq_page_ref`  
   - 类型：Post Object（仅允许选择 Page）  
   - 用途：
     - 其他页面生成「查看全部 FAQ」按钮的链接

2. 默认 FAQ Intro 标题
   - 字段名：`faq_intro_title_default`  
   - 类型：Text  
   - 默认值建议设置为当前文案「We welcome question!」

3. 默认 FAQ Intro 文本
   - 字段名：`faq_intro_text_default`  
   - 类型：Textarea 或 Wysiwyg Editor  
   - 默认值建议设置为当前说明段落

4. 默认 FAQ Intro 按钮文案
   - 字段名：`faq_intro_button_text_default`  
   - 类型：Text  
   - 默认值建议设置为「CONTACT US NOW→」

5. 默认 FAQ Intro 按钮链接（推荐使用 Page 引用）
   - 方案一：通过页面引用
     - 字段名：`faq_intro_button_page_default`  
     - 类型：Post Object（仅限 Page，建议选择 Contact 页面）  
     - 实现：模板中通过 `get_permalink()` 输出 URL  
   - 方案二：保底 URL
     - 字段名：`faq_intro_button_url_default`  
     - 类型：URL / Text  
     - 当未选择页面时，使用此 URL 作为按钮 href（可填入现有 `https://easyceo.site/contact/` 以保持兼容）

   两者可同时存在，优先：`faq_intro_button_page_default` → `faq_intro_button_url_default`。

6. 默认 FAQ 列表（问题与答案）
   - 字段名：`faq_items_default`  
   - 类型：Repeater  
   - 子字段：
     - 问题：`question`（Text）  
     - 答案：`answer`（Textarea 或 Wysiwyg Editor）  
     - 锚点 ID：`slug`（Text，可选，用于生成 `<div id="...">`，便于前端跳转/SEO）  
     - 默认展开：`is_default_open`（True/False，布尔）  
   - 说明：
     - 初始可根据当前 7 条静态问答录入为默认值  
     - 未来如 FAQ 数量增减，只需在 Options 中调整

7. FAQ 显示条数默认值（可选）
   - 字段名：`faq_items_per_page_default`  
   - 类型：Number  
   - 用途：如需限制在某些页面仅显示前 N 条 FAQ 时可用

> 说明：全局 CTA 弹窗相关字段（如 `global_contact_popup_id` 等）已在「工厂页面动态化方案」中规划，此处 FAQ Intro 使用的是「跳转到 Contact 页面」的普通链接，不依赖弹窗。

---

## 五、ACF 字段设计（FAQ 页面字段组）

在 FAQ 页面编辑界面挂载一个字段组「常见问题页面设置」，用于覆盖全局默认。

### 5.1 字段组：常见问题页面设置（faq_page_settings）

位置规则：

- Post Type 等于 Page  
- 且 Page 等于 FAQ（或通过 Page Template 绑定到 `page-faq.php`）

字段建议：

1. Hero 区覆盖字段（复用通用 Hero 结构）

若已按照「关于我们动态化方案」实现了通用 Hero 字段组 `Page Hero 通用配置`，FAQ 页面可以直接使用同一套字段（`hero_title`、`hero_subtitle`、`hero_background_image`），无需在本字段组重复定义。  

如需 FAQ 特有补充，可在此组中增加：

- 字段名：`faq_hero_badge_text`（Text，可选，用于在标题旁增加小标签，如「Support」）

2. FAQ Intro 覆盖字段

- FAQ Intro 标题（覆盖）
  - 字段名：`faq_intro_title`  
  - 类型：Text  
  - 若为空则使用 `faq_intro_title_default`

- FAQ Intro 文本（覆盖）
  - 字段名：`faq_intro_text`  
  - 类型：Textarea/Wysiwyg  
  - 若为空则使用 `faq_intro_text_default`

- FAQ Intro 按钮文案（覆盖）
  - 字段名：`faq_intro_button_text`  
  - 类型：Text  
  - 若为空则使用 `faq_intro_button_text_default`

- FAQ Intro 按钮链接（推荐同样使用 Page 引用 + URL 兜底）
  - 字段名：`faq_intro_button_page`（Post Object，Page）  
  - 字段名：`faq_intro_button_url`（URL/Text）  
  - 链接生成优先级：  
    - 页面级 `faq_intro_button_page` → 页面级 `faq_intro_button_url` → 全局 `faq_intro_button_page_default` → 全局 `faq_intro_button_url_default`

3. FAQ 列表覆盖字段

- 字段名：`faq_items`  
- 类型：Repeater  
- 子字段：
  - 问题：`question`（Text）  
  - 答案：`answer`（Textarea/Wysiwyg）  
  - 锚点 ID：`slug`（Text，可选）  
  - 默认展开：`is_default_open`（True/False）  

数据来源优先级：

1. 若当前页面 `faq_items` 有内容，则使用页面级列表  
2. 若页面级为空，则使用全局 `faq_items_default`  

4. FAQ 关联页面（可选，用于联动）

- 字段名：`faq_related_pages`  
- 类型：Relationship / Post Object（允许多选 Page）  
- 用途：在 FAQ 页面底部展示「与这些内容相关」链接，如 About / Factory / Quality 等，增强页面间联动

---

## 六、各模块实现要点（逻辑层面）

下面仅描述推荐的逻辑与数据来源，具体 PHP 代码实现应在对应模板文件中完成，并保持现有 HTML 结构/属性不变。

### 6.1 Hero 区 `page-hero-title`（复用）

- 使用在全站统一规划的 Hero 字段逻辑：  
  1. 优先使用 FAQ 页面上的 `hero_title`/`hero_subtitle`/`hero_background_image`  
  2. 若为空则使用 Options 上的全局默认 Hero 字段  
  3. 若仍为空，`hero_title` 退回 `get_the_title()`，其他字段不输出

- FAQ 页面可通过 `hero_subtitle` 添加简短说明，如「Find Answers To The Most Common Questions」。

### 6.2 FAQ Intro 模块 `faq-intro.php` 动态化

当前结构中，左列包含标题、段落和按钮，右列包含 `faq-accordion`。改造要点：

1. 标题与文案

- 获取顺序：

```php
$intro_title = get_field('faq_intro_title');
if (!$intro_title) {
    $intro_title = get_field('faq_intro_title_default', 'option');
}

$intro_text = get_field('faq_intro_text');
if (!$intro_text) {
    $intro_text = get_field('faq_intro_text_default', 'option');
}
```

- 若仍为空，可保留当前硬编码文本作为最终兜底。

2. 按钮文案

```php
$btn_text = get_field('faq_intro_button_text');
if (!$btn_text) {
    $btn_text = get_field('faq_intro_button_text_default', 'option');
}
```

3. 按钮链接

```php
$btn_page = get_field('faq_intro_button_page');
if (!$btn_page) {
    $btn_page = get_field('faq_intro_button_page_default', 'option');
}

if ($btn_page) {
    $btn_url = get_permalink($btn_page);
} else {
    $btn_url = get_field('faq_intro_button_url', 'option')
        ?: 'https://easyceo.site/contact/'; // 作为最终兜底
}
```

4. 前端结构

- 保持现有 Elementor 结构与 class 不变，仅将标题、段落、按钮文案和 href 替换为动态变量  
- 若未来需要在其他页面复用该模块，可抽象为接收参数（如 `$context_page_id`），从不同页面或 Options 中读取同一组字段

### 6.3 FAQ Accordion 模块 `faq-accordion.php` 动态化

1. 数据获取

```php
$faq_items = get_field('faq_items');
if (!$faq_items) {
    $faq_items = get_field('faq_items_default', 'option');
}
```

2. DOM 结构要求

- 外层容器：
  - 保持 `<div class="eael-adv-accordion" ...>` 的 `id`、`data-accordion-id`、`data-accordion-type` 等属性不变，以确保 EAEL JS 能正常工作  
- 内部每条记录：
  - 保持 `.eael-accordion-list` 包裹  
  - title 区使用 `.elementor-tab-title.eael-accordion-header`  
  - content 区使用 `.eael-accordion-content`  
  - `data-tab` 建议使用循环计数 `$index`（从 1 开始）  
  - `id`、`aria-controls` 等可以基于 `slug` 或 index 生成，格式参考当前静态结构

3. 示例生成逻辑（结构示意）

```php
if ($faq_items) {
    $index = 0;
    foreach ($faq_items as $item) {
        $index++;
        $question = $item['question'] ?? '';
        $answer   = $item['answer'] ?? '';
        $slug     = $item['slug'] ?: 'faq-item-' . $index;
        $open     = !empty($item['is_default_open']);

        // 根据 $index/$slug 生成 id、aria-* 等属性
        // 输出与当前 EAEL 结构一致的 HTML
    }
}
```

- 至少保持：
  - 标题容器：`data-tab="<?php echo $index; ?>"`
  - 内容容器：`data-tab="<?php echo $index; ?>"`
  - `aria-controls` 与 `aria-labelledby` 互相对应，提升可访问性

4. 默认展开项

- 根据 `is_default_open` 字段为该项增加：
  - 标题：`class="... active-default"`  
  - 内容：`class="eael-accordion-content clearfix active-default"`  
- 若无任何项标记为默认展开，则可保持全部收起状态

5. 控制显示数量（可选）

- 若在某些页面只需要展示前 N 条 FAQ，可在循环前先根据 `faq_items_per_page_default` 或局部设置进行 `array_slice` 限制

---

## 七、跨页面联动设计

结合 About / Factory 等页面已有或规划中的字段，FAQ 页面建议做如下联动设计：

1. FAQ 页面引用字段 `faq_page_ref`
   - 其他页面（如 Quality Manufacturing、Why Us、产品页）的 CTA 上使用：  
     - 若 `faq_page_ref` 已设置，则按钮链接到该页面  
     - 未设置时可回退到当前 FAQ 页面固定链接或不显示按钮

2. 联系我们页面引用（全局）
   - 若在其他方案中已定义 `contact_page_ref`，FAQ Intro 按钮可优先使用该字段  
   - 若未定义，可在 Options 中增补此字段，并在 FAQ Intro / 页脚等处复用

3. FAQ 片段嵌入其他页面
   - 在需要 FAQ 片段的页面（如产品详情）中：
     - 通过 include `faq-accordion.php` 组件  
     - 或单独编写一个 `template-parts/components/faq-snippet.php`，从全局 `faq_items_default` 中读取前 N 条并输出

---

## 八、实施步骤建议

1. 在 ACF 中创建 Options Page（若已存在则跳过）并添加字段组「FAQ 全局设置」，按第 4 节配置字段  
2. 在 FAQ 页面（使用 `page-faq.php` 模板的页面）上添加字段组「常见问题页面设置」，按第 5 节配置字段  
3. 确认 `page-hero-title.php` 已接入通用 Hero 字段逻辑（参考「关于我们动态化方案」），FAQ 页面无需额外调整 Hero 部分  
4. 在 `[faq-intro.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/one_page/faq-intro.php)` 中：
   - 将标题、文案、按钮文案、按钮链接替换为 ACF 获取的动态值  
   - 保持原有 HTML 结构与 class、data 属性不变
5. 在 `[faq-accordion.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/one_page/faq-accordion.php)` 中：
   - 使用 Repeater 生成 `.eael-accordion-list` 列表  
   - 严格保留 EAEL 所需的结构和 `data-tab`、`aria-*` 属性  
   - 支持 `is_default_open` 控制默认展开项
6. 在其他相关页面模板中（如产品页、质量制造页），如需添加「更多常见问题」入口：
   - 通过 Options 中的 `faq_page_ref` 生成链接  
   - 保持全站指向 FAQ 页的统一性
7. 回到 WordPress 后台：
   - 在 Options 中录入默认 FAQ Intro 内容和默认 FAQ 列表  
   - 在 FAQ 页面中按需覆盖部分内容  
   - 检查前端页面，确认样式和交互与静态版本一致

---

通过以上方案，在不改变现有页面结构和用户体验的前提下，实现了 FAQ 页的全面动态化，同时为其他页面复用 FAQ 数据和统一 CTA/联系入口提供了基础。

