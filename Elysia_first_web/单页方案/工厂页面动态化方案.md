# 工厂页面动态化方案（基于 ACF 与 WordPress 原生能力）

## 一、目标与原则

- 保持现有页面样式与前端结构不变，仅替换为动态数据输出  
- 只使用 ACF 插件与 WordPress 原生能力（核心函数、文章类型、菜单、媒体库等）  
- 复用已有组件（尤其是页头 page-hero-title 与弹窗按钮样式），避免重复开发  
- 支持与其他页面（特别是「关于我们」页面）之间的数据与跳转联动  
- 所有字段设计遵循「全局默认 + 页面级覆盖」两层结构，方便统一运营

---

## 二、涉及模板与模块梳理

### 2.1 页面与主模板

- 页面：Factory（工厂页面，对应后台单页，slug 通常为 `factory`）  
- 模板文件：
  - `page-factory.php`：工厂页面主模板

### 2.2 工厂页面相关模块

以下模块位于 `template-parts/one_page/` 目录中：

- `factory-intro.php`：工厂简介模块（左文案 + 右图片 + CONTACT US 按钮/弹窗）  
- `factory-gallery.php`：工厂图片画廊（目前为静态 4 列 gallery）  
- `factory-details-intro.php`：工厂详情文字模块（较长段落介绍）  
- `factory-details-grid.php`：工厂详情三列图文模块（如 Lean Production Line / Manufacturing Team / Equipment Warehouse）  

其他可复用模块（来自已规划好的关于我们页面）：

- `page-hero-title.php`：通用页头模块（主标题/副标题 + 面包屑）  
- 统一的 CONTACT / CATALOG 弹窗触发按钮组件（由 Elementor 弹窗 ID 控制）

---

## 三、整体动态化设计思路

### 3.1 两层字段结构

1. 全局层（Options Page）
   - 通过 ACF Options Page 定义「工厂页面默认内容」，在无页面级覆盖时使用  
   - 适合不会频繁变化、且可能在其他页面复用的内容，例如：
     - 工厂整体介绍文案  
     - 工厂优势三大块（标题+描述+图片）  
     - 联系方式相关 CTA 按钮文案、弹窗 ID 等  
     - 工厂图库默认图片列表  

2. 页面层（Factory 页面编辑页）
   - 在 Factory 单页编辑界面追加「工厂页面设置」字段组  
   - 当页面级字段有值时，优先使用页面级；否则回退到全局默认  
   - 方便未来如果有第二个工厂页面（如其他国家工厂）时可单独配置

### 3.2 模块级复用策略

- 页头 `page-hero-title`：  
  - 与「关于我们」页面复用同一套 ACF 字段结构（全局通用 + 页面覆盖）  
  - 通过在 Factory 页面字段组中增加「Hero 标题」「Hero 副标题」「面包屑附加文案」等字段实现  

- 联系弹窗按钮：  
  - 在全局 Options 中维护：
    - CONTACT 弹窗 ID（如 306）  
    - CATALOG 弹窗 ID（如 2636）  
    - 按钮文案（CONTACT US / DOWNLOAD CATALOG 等）  
  - Factory 页面、About Us 页面等所有需要触发弹窗的位置均读取同一套字段  
  - 保持 Elementor 弹窗与按钮样式不变，仅动态化 ID 与文案

- 工厂介绍与优势模块：  
  - 工厂简介、工厂优势三列图文均设计成可配置数量的 Repeater，  
    后续如在其他页面需要「工厂优势」模块时可直接 include 同一模板，并传入数据源（页面 ID 或全局）  

### 3.3 与其他页面的联动

- 「关于我们」页面中的工厂 CTA 区块：
  - 不再硬编码 /factory/ 链接，而是通过 ACF Post Object/关系字段选择「工厂页面」  
  - Factory 页面 URL 如变更，仅需在 Options 中更新一次即可  

- 全站 CTA 统一：
  - 联系弹窗、下载手册弹窗的文案和弹窗 ID 从全局 Options 读取  
  - About Us、Factory、其他产品相关页面都使用同一套字段，实现统一运营

---

## 四、ACF 字段设计（全局 Options）

创建 ACF Options Page，例如「网站全局设置」，在其中添加以下字段组。

### 4.1 全局：工厂页面默认内容（字段组）

- 字段组名称：工厂页面默认内容（global_factory_defaults）  
- 显示位置：Options Page（如 theme-general-settings）

字段设计：

1. 工厂页面引用
   - 字段名：`factory_page_ref`  
   - 类型：Post Object（只允许选择页面，且建议过滤 slug=factory）  
   - 用途：
     - 提供「关于我们」等页面跳转到工厂页面时使用  

2. 默认工厂主标题
   - 字段名：`factory_default_title`  
   - 类型：Text  
   - 作用：作为 Factory 页头主标题的默认值

3. 默认工厂副标题
   - 字段名：`factory_default_subtitle`  
   - 类型：Text  
   - 作用：作为 Factory 页头副标题的默认值

4. 默认工厂简介（左侧文案）
   - 字段名：`factory_default_intro_text`  
   - 类型：Wysiwyg Editor 或 Textarea  

5. 默认工厂简介配图（右侧图片）
   - 字段名：`factory_default_intro_image`  
   - 类型：Image  

6. 默认工厂图库
   - 字段名：`factory_default_gallery`  
   - 类型：Gallery（或 Repeater+Image）  
   - 说明：可上传多张工厂环境图片，在 `factory-gallery.php` 中循环输出

7. 默认工厂详情主文案（对应 factory-details-intro）
   - 字段名：`factory_default_details_intro`  
   - 类型：Wysiwyg Editor 或 Textarea  

8. 默认工厂详情三列图文（对应 factory-details-grid）
   - 字段名：`factory_default_details_boxes`  
   - 类型：Repeater  
   - 子字段：
     - 标题：`title`（Text）  
     - 说明：`description`（Textarea/Wysiwyg）  
     - 图片：`image`（Image）  

### 4.2 全局：CTA 与弹窗设置（字段组）

- 字段组名称：全局 CTA 与弹窗设置（global_cta_popup_settings）  
- 显示位置：Options Page

字段设计：

1. CONTACT 弹窗 ID
   - 字段名：`global_contact_popup_id`  
   - 类型：Text  
   - 示例：`306`

2. CONTACT 按钮文案
   - 字段名：`global_contact_button_text`  
   - 类型：Text  
   - 示例：`CONTACT US`

3. CATALOG 弹窗 ID（如有）
   - 字段名：`global_catalog_popup_id`  
   - 类型：Text  

4. CATALOG 按钮文案
   - 字段名：`global_catalog_button_text`  
   - 类型：Text  

这些字段将被 Factory 页面、About Us 页面等所有需要弹窗按钮的模块复用。

---

## 五、ACF 字段设计（Factory 页面字段组）

在 Factory 页面编辑界面中挂载一个字段组「工厂页面设置」，用于覆盖全局默认。

### 5.1 字段组：工厂页面设置（factory_page_settings）

显示位置：  
- Post Type 等于 Page  
- 并且 Page 等于 Factory（或通过 Page Template 绑定到 `page-factory.php`）

字段设计：

1. Hero 区标题覆盖
   - 字段名：`factory_hero_title`（Text）  
   - 字段名：`factory_hero_subtitle`（Text）  
   - 字段名：`factory_hero_breadcrumb_extra`（Text，可选）  

2. 工厂简介覆盖（对应 `factory-intro.php` 左侧文案与右侧图片）
   - 字段名：`factory_intro_text`（Wysiwyg Editor）  
   - 字段名：`factory_intro_image`（Image）  
   - 字段名：`factory_intro_contact_button_text`（Text，可选）  
     - 若为空则回退到全局 CONTACT 按钮文案

3. 工厂图库覆盖（对应 `factory-gallery.php`）
   - 字段名：`factory_gallery`（Gallery 或 Repeater+Image）  
   - 若为空则使用 `factory_default_gallery`

4. 工厂详情主文案覆盖（对应 `factory-details-intro.php`）
   - 字段名：`factory_details_intro`（Wysiwyg Editor）  
   - 若为空则使用 `factory_default_details_intro`

5. 工厂详情三列图文覆盖（对应 `factory-details-grid.php`）
   - 字段名：`factory_details_boxes`（Repeater）  
   - 子字段：
     - 标题：`title`（Text）  
     - 说明：`description`（Textarea/Wysiwyg）  
     - 图片：`image`（Image）  
   - 若 Repeater 为空，则使用全局 `factory_default_details_boxes`

6. 与其他页面联动设置（可选）
   - 字段名：`factory_related_pages`（Relationship / Post Object，限制为 Page）  
   - 用途：在工厂页面底部展示与工厂相关的其他页面（如 About Us / Certification 等），也为后续联动预留空间

---

## 六、各模块实现要点（逻辑层面）

以下为推荐的逻辑方案，实际代码实现需在对应模板中完成。

### 6.1 页头 page-hero-title（复用方案）

- 读取顺序：
  1. Factory 页面上的 `factory_hero_title`、`factory_hero_subtitle`  
  2. 若为空，则回退到 Options 中的 `factory_default_title`、`factory_default_subtitle`  
  3. 若仍为空，可再退回到当前页面的 `post_title` 等

- 面包屑附加文案：
  - 若存在 `factory_hero_breadcrumb_extra`，在面包屑末尾追加

### 6.2 factory-intro.php 动态化

- 左侧文案：
  - 尝试获取 Factory 页面字段 `factory_intro_text`  
  - 若为空，则使用 Options 中的 `factory_default_intro_text`  

- 右侧图片：
  - 尝试获取 Factory 页面字段 `factory_intro_image`  
  - 若为空，则使用 Options 中 `factory_default_intro_image`  

- CONTACT 按钮：
  - 按钮文案：
    - 优先使用 Factory 页面字段 `factory_intro_contact_button_text`  
    - 若为空，使用 `global_contact_button_text`  
  - 弹窗 ID：
    - 从 Options 中读取 `global_contact_popup_id`  
  - 前端结构：
    - 保持原有 `<a>` 标签与 Elementor 相关的 `data-elementor-open-lightbox` / `href` 结构不变  
    - 只将其中的 ID 与按钮文字替换为动态值

### 6.3 factory-gallery.php 动态化

- 数据来源：
  - 优先使用 Factory 页面字段 `factory_gallery`（允许上传多图）  
  - 若为空使用 Options 中 `factory_default_gallery`

- 输出结构：
  - 使用 WordPress 原生 Gallery 结构（`<figure class='gallery-item'>` 等）或者继续沿用当前 HTML 结构  
  - 对每张图片输出：
    - `src`、`srcset`、`sizes` 由 WordPress 媒体库自动提供  
    - `alt`、`title` 优先使用媒体库中设置的值  

- 若未来需要复用到其他页面：
  - 通过 include `factory-gallery.php` 并在模板中调整为根据传入的 gallery 字段名或页面 ID 读取

### 6.4 factory-details-intro.php 动态化

- 内容来源：
  - 优先使用 Factory 页面字段 `factory_details_intro`  
  - 若为空则使用 Options 中 `factory_default_details_intro`

- 输出：
  - 保持现有段落结构与样式 class 不变，仅替换内部文本

### 6.5 factory-details-grid.php 动态化

- 数据来源：
  - 优先使用 Factory 页面字段 `factory_details_boxes`（Repeater）  
  - 若为空则使用 Options 中 `factory_default_details_boxes`

- 循环输出：
  - 对每个 Repeater 项输出一列：  
    - 图片：保持当前 `<figure>` / `<img>` 包裹结构不变  
    - 标题：替换为 Repeater 中 `title`  
    - 描述：替换为 Repeater 中 `description`  

- 与其他页面复用：
  - 若后续在关于我们或其他页面也需要类似「三列图文」展示，可抽象此模板为通用组件，通过参数或当前页面字段名读取数据

---

## 七、与「关于我们」页面的联动设计

结合已完成的「关于我们动态化方案」，工厂页面联动方式如下：

1. 工厂页面引用字段（Options 中 `factory_page_ref`）  
   - 关于我们页面的「工厂介绍/CTA」模块读取该字段获取工厂页面链接  
   - 生成按钮链接或「了解更多」跳转链接，当 Factory 页面 URL 变化时无需修改模板

2. 统一 CTA 弹窗：
   - 关于我们页面中的 CONTACT US / DOWNLOAD CATALOG 按钮使用全局 CTA 字段  
   - Factory 页面也使用同一套字段，实现统一弹窗与文案

3. 视觉与模块复用：
   - 若关于我们页面下方需要简要展示工厂优势，可直接 include `factory-details-grid.php`，  
     并通过判断当前页面类型选择数据来源：
     - 在 Factory 页面：使用 Factory 页面字段/全局工厂默认字段  
     - 在 About 页面：可单独增加 About 页面自己的 Repeater 字段或共享工厂字段

---

## 八、实施步骤建议

1. 在 ACF 中创建 Options Page，并配置「工厂页面默认内容」与「全局 CTA 与弹窗设置」字段组  
2. 在 Factory 页面对应的字段组中实现本文所述的覆盖字段  
3. 在 `page-factory.php` 中确保依次加载：
   - `page-hero-title.php`（已支持 ACF 字段）  
   - `factory-intro.php`  
   - `factory-gallery.php`  
   - `factory-details-intro.php`  
   - `factory-details-grid.php`  
4. 分别在上述 4 个模块模板文件中接入 ACF 数据读取与回退逻辑  
5. 在关于我们页面相关模块中接入 `factory_page_ref` 与全局 CTA 字段，实现跳转与弹窗联动  
6. 回到 WordPress 后台，填写 Options 与 Factory 页面字段，确认视觉效果与原静态页面一致

---

以上方案在不引入任何新插件的前提下，通过 ACF 与 WordPress 原生能力，实现工厂页面的全面动态化，同时兼顾组件复用与与其他页面的联动能力。

