# 质量制造模块拆分核对报告

**文件对象**：`wp-content/themes/Elysia_first_web/page-quality-manufacturing.php`  
**拆分目标**：将 Elementor 导出的 “Quality Manufacturing” 页面静态 HTML 拆分为可维护的 WordPress 模块（`template-parts/one_page/` + 全站组件），同时保持现有样式与动效完全不变。

---

## 1. 拆分清单表格

| 建议文件名（template-parts/） | 功能描述 | HTML 标识/锚点 | 重用性评估 |
| :--- | :--- | :--- | :--- |
| **`one_page/quality-manufacturing-hero.php`** | 页面首屏标题区，仅包含 “Quality Manufacturing” 主标题及背景 Overlay。 | `section.elementor-top-section[data-id="abc70fe"]`，内部 `h1.elementor-heading-title` 文本为 `Quality Manufacturing`。 | **跨页面可复用**：结构完全符合《全站模块分析》中 `page-hero-title` 的模式（单页首屏 Hero），可在 About / Why Us / Factory 等单页中统一为 `components/page-hero-title.php`。现阶段可先保留为单页 Hero 片段。 |
| **`one_page/quality-manufacturing-intro.php`** | 质量制造介绍区块：左侧 SATISFY Manufacturing + “Sunway, Expert In cold roll forming machine Manufacturing” 标题 + 一段说明文字 + 「CONTACT US」按钮；右侧大图 “Quality Manufacturing 1”。 | `section.elementor-top-section[data-id="681a35c1"]`，内部左列 `data-id="6ceec239"` + 右列 `data-id="1a1148f8"`。 | **单页私有**：文案与配图完全围绕 Quality Manufacturing 场景，目前仅此页使用；可以与 Factory / About 类似介绍段在视觉上对齐，但业务文案不适合作为全站组件。 |
| **`one_page/quality-manufacturing-worth-invest.php`** | “WORTHY INVEST / The Production Of Sunway Your Next Worth Ordering” 标题 + 下方三列价值卡片（每列包含图标、标题、说明文案，构成质量与认证的价值主张）。 | 顶部标题区：`section.elementor-top-section[data-id="3225afaa"]`；三列卡片区：`section.elementor-top-section[data-id="4df2d271"]`，内部 `elementor-inner-section[data-id="63dc345a"]` 等。 | **单页私有（可复用候选）**：结构为标准的 3 列价值卡片，适合在其它品牌/优势类页面复用，但当前文案（认证、质量承诺）与本页绑定。建议先作为 Quality Manufacturing 页面模块，后续若在其它页面出现同构卡片可抽象为通用组件。 |
| **`one_page/quality-manufacturing-supply-chain.php`** | 供应链与一站式解决方案叙述模块：包含「Supply Chain Details / We Always Ready To Be Your Partner」标题，以及两个连续的图文段落：01. We Always Ready（图左文右）、02. One-Stop Solution（图右文左）。整体讲述供应链能力、库存、技术支持与研发。 | 标题区：`section.elementor-top-section[data-id="3546e172"]`；第一段：`section.elementor-top-section[data-id="2b173aac"]`（图左文右）；第二段：`section.elementor-top-section[data-id="59c90320"]`（`elementor-reverse-mobile elementor-reverse-tablet`，图右文左）。 | **单页私有（可复用候选）**：结构上是「章节标题 + 多个图文 Row」的标准叙述模式，可推广到其它服务/能力页面；但当前编号（01/02）及文案强绑定质量制造主题，暂定为此页私有模块。 |
| **`one_page/shared-contact-popup.php`** | 「Get in touch with sunway」联系弹窗，承载 Zoho Contact Form iframe，由各页面内的「CONTACT US」按钮（`#elementor-action:action=popup:open&id=306`）触发。 | `<div data-elementor-type="popup" data-elementor-id="306" class="elementor elementor-306 elementor-location-popup">`，内部 `h1` 文案为 `Get in touch with sunway`，`iframe[aria-label="Sunway Contact Form"]`。 | **跨单页可复用**：同一结构出现在 Factory / Why Us / Quality Manufacturing 等多页，适合作为单页共享弹窗。当前《全站模块分析》未单独列出，可先放在 `one_page/` 目录并在多页复用，后续如确认为全站级能力，可上升为 `components/popup-contact.php`。 |
| **`components/popup-catalog-download.php`** | 「Latest Price & Catalog」全站级营销弹窗，承载 Zoho Catalog Download Contact Form iframe，按配置在页面加载后延时弹出。 | `<div data-elementor-type="popup" data-elementor-id="2636" class="elementor elementor-2636 elementor-location-popup">`，内部 `h3.elementor-heading-title` 文案为 `Latest Price &amp; Catalog`，`iframe[aria-label*="Sunway Catalog Download Contact Form"]`。 | **全站通用组件**：与《全站模块分析》中“全站营销弹窗（popup-catalog-download）”完全一致，应抽离到 `template-parts/components/popup-catalog-download.php`，由 `footer.php` 统一调用，而不是在各个页面模板中重复维护。 |

> 说明：  
> - 上述模块依然基于「Elementor Section 作为最小结构单元」的原则：每个建议文件负责输出一个或数个紧密相关的 `section.elementor-top-section`。  
> - 表格中最后一行虽然不在 `one_page/` 目录，但由于其在《模块映射》中已被归类为全站组件，这里直接按组件路径给出建议文件名。

---

## 2. 拆分后的 page-quality-manufacturing.php 结构预览

拆分后，`page-quality-manufacturing.php` 只负责：

- 保留现有的 CSS / JS 引入与内联样式；
- 保留 `<main>` / `<article>` / `.entry-content` / `.elementor` 这些骨架容器；
- 通过 `get_template_part()` 调度具体模块；
- 在底部仍然输出本页专属的懒加载脚本。

示例结构（示意关键部分）：

```php
<?php
/**
 * Template Name: 质量制造
 * 质量制造页模板（从 swforming/index-8.html 迁移）
 */
get_header();
?>

<?php // 样式与脚本：保持与当前文件一致，仅示意几行 ?>
<link rel='stylesheet' id='blocksy-dynamic-global-css' href='<?php echo get_template_directory_uri(); ?>/static/css/global.css' media='all' />
<link rel='stylesheet' id='wp-block-library-css' href='<?php echo get_template_directory_uri(); ?>/static/css/style.min.css' media='all' />
<!-- 省略其它 CSS、内联样式、Woo JS、trp 脚本等 -->

<main id="main" class="site-main hfeed">
    <div class="ct-container-full" data-content="normal">
        <article id="post-248" <?php post_class('page type-page status-publish hentry'); ?>>
            <div class="blocksy-woo-messages-default woocommerce-notices-wrapper">
                <div class="woocommerce"></div>
            </div>

            <div class="entry-content is-layout-constrained">
                <div data-elementor-type="wp-page"
                     data-elementor-id="248"
                     class="elementor elementor-248"
                     data-elementor-post-type="page">

                    <?php
                    // 1. 单页首屏 Hero：Quality Manufacturing 标题
                    get_template_part( 'template-parts/one_page/quality-manufacturing-hero' );

                    // 2. SATISFY Manufacturing 图文介绍 + CONTACT US 按钮
                    get_template_part( 'template-parts/one_page/quality-manufacturing-intro' );

                    // 3. WORTHY INVEST 三列价值卡片
                    get_template_part( 'template-parts/one_page/quality-manufacturing-worth-invest' );

                    // 4. Supply Chain Details + 01/02 两段供应链叙述
                    get_template_part( 'template-parts/one_page/quality-manufacturing-supply-chain' );
                    ?>

                </div>
            </div>
        </article>
    </div>
</main>

<?php
// 5. 联系弹窗（跨多个单页复用）
get_template_part( 'template-parts/one_page/shared-contact-popup' );

// 全站 Catalog 下载弹窗应由 footer.php 统一调用：
// footer.php 内：get_template_part( 'template-parts/components/popup-catalog-download' );

get_footer();
?>
```

> 提示：  
> - 上述示例中未包含顶部所有 `<link>`/`<script>` 行，只是说明拆分后整体调用方式。  
> - 实际拆分时，只需要将对应的 `section...` HTML 移入 `template-parts/one_page/*.php` 文件，保持内部结构与当前完全一致。

---

## 3. 核心注意项

拆分 Quality Manufacturing 页面为模块时，建议重点关注以下技术细节：

1. **Elementor Section 结构必须原样保留**

   - 各模块文件内部要完整保留原有的 Section 容器及属性：
     - `class="elementor-section elementor-top-section ..."`
     - `data-id="abc70fe"` / `data-id="681a35c1"` 等
     - `data-element_type="section"`、`data-settings="{...}"` 等 JSON 配置
   - 尤其是带动画与背景的 Section（如 `4df2d271` 区块内部带 `elementor-inner-section` 和 `elementor-background-overlay`），这些属性直接影响样式与 motion 效果，不能在拆分过程中丢失。

2. **脚本与全局对象保持在主模板中**

   - WooCommerce 相关全局对象与脚本：
     - `wc_add_to_cart_params`（`wc-add-to-cart-js-extra`）
     - `woocommerce_params`（`woocommerce-js-extra`）
     - 以及 `add-to-cart.min.js`、`woocommerce.min.js`、`jquery.blockUI.min.js` 等
   - 应继续保留在 `page-quality-manufacturing.php` 头部区域，**不要**拆分到各个 `template-parts` 中，否则容易导致重复注入或加载顺序错乱。
   - 同样，`trp-frontend-compatibility.js`、字体 CSS 等全局资源也应留在主模板或统一头部逻辑中。

3. **懒加载脚本保持唯一且集中**

   - 文件末尾的懒加载脚本：

     ```js
     const lazyloadRunObserver = () => {
         const lazyloadBackgrounds = document.querySelectorAll(`.e-con.e-parent:not(.e-lazyloaded)`);
         const lazyloadBackgroundObserver = new IntersectionObserver((entries) => {
             entries.forEach((entry) => {
                 if (entry.isIntersecting) {
                     let lazyloadBackground = entry.target;
                     if (lazyloadBackground) {
                         lazyloadBackground.classList.add('e-lazyloaded');
                     }
                     lazyloadBackgroundObserver.unobserve(entry.target);
                 }
             });
         }, {
             rootMargin: '200px 0px 200px 0px'
         });
         lazyloadBackgrounds.forEach((lazyloadBackground) => {
             lazyloadBackgroundObserver.observe(lazyloadBackground);
         });
     };
     ['DOMContentLoaded', 'elementor/lazyload/observe'].forEach((event) => {
         document.addEventListener(event, lazyloadRunObserver);
     });
     ```

   - 建议继续保留在 `page-quality-manufacturing.php` 中（或未来统一抽出到一个全局脚本片段），**不要**复制到各个 `template-parts` 中，以避免重复监听事件或产生性能问题。

4. **全局变量与 WooCommerce Hooks**

   - 当前 Quality Manufacturing 页面没有自定义 `WP_Query` 或 WooCommerce 产品 Loop，不直接依赖全局 `$product`。
   - 只要在拆分过程中不新增自定义查询、不过度操作 `global $post`，就不会影响现有 Loop。
   - 若未来在 `quality-manufacturing-worth-invest.php` 或 `quality-manufacturing-supply-chain.php` 中加入产品推荐（如展示部分产品卡片），建议：
     - 在对应模块内部新建 `WP_Query` 并在结束后调用 `wp_reset_postdata()`；
     - 或使用 Woo Hook（如后续从 Woo 模板注入该段落）时，在 `functions.php` 中封装输出逻辑，保持主模板干净。

5. **全站营销弹窗（Catalog Download）必须抽象为组件**

   - `<div data-elementor-id="2636">` 区块是标准的「全站营销弹窗（popup-catalog-download）」：
     - 《模块映射》建议文件：`template-parts/components/popup-catalog-download.php`
     - 调用方式：`footer.php` 内统一调用。
   - Quality Manufacturing 页面拆分时，应：
     - 将该片段从当前页面模板中剥离；
     - 避免在其它页面再出现重复 HTML；
     - 利用 `footer.php` 统一挂载，保证全站同一套文案、触发时机（如 `page_load_delay: 30`）和展示次数策略。

6. **联系弹窗（ID=306）的复用策略**

   - `data-elementor-id="306"` 的「Get in touch with sunway」弹窗目前在多个内容页使用（Factory / Why Us / Quality Manufacturing 等），但未在《全站模块分析》中单列为全站模块。
   - 建议：
     - 先在 `template-parts/one_page/shared-contact-popup.php` 中维护一份标准结构；
     - Quality Manufacturing / Why Us / Factory 等单页统一通过 `get_template_part('template-parts/one_page/shared-contact-popup')` 调用；
     - 后续如确认该弹窗为真正的全站级能力（包括首页、归档等均使用），再上升到 `components/popup-contact.php` 并由 `footer.php` 或特定 Hook 挂载。

7. **组件复用与命名规范**

   - Hero 区块：与 About / Why Us / Factory 页面的首屏标题结构一致，长远建议抽象为 `components/page-hero-title.php`，由各单页模板传入标题（可以用 `the_title()` 或 ACF 字段），从而统一视觉与代码结构。
   - 文件命名：本报告中建议的文件名均遵守《模块映射》中“语义化、短、小写、连字符”的命名习惯，如 `quality-manufacturing-supply-chain.php`，避免使用难以理解的拼音或 data-id 值命名。
   - 若你已经在其它页面（如 Factory / Why Us）创建了对应模块文件（如 `one_page/shared-contact-popup.php`），请在 Quality Manufacturing 页面直接复用，而不是再新建一个同逻辑文件。

---

整体上，质量制造页面的模块拆分可以与 Why Us / Factory 保持同一拆分粒度和命名风格：  

- 顶部 Hero 区块 → 对应 `page-hero-title` 类型模块；  
- 中部为 1 个介绍模块 + 1 个价值主张模块 + 1 个供应链叙述模块 → 全部落在 `template-parts/one_page/`；  
- 底部 2 个弹窗 → 其中联系弹窗作为跨单页共享模块（`one_page/shared-contact-popup.php`），Catalog 弹窗作为全站组件（`components/popup-catalog-download.php`）。  

后续如果你愿意，可以直接根据本报告逐个抽取对应 `section...` 区块到 `template-parts/one_page/*.php` 文件中，并改写 `page-quality-manufacturing.php` 为 `get_template_part()` 调用式结构。

