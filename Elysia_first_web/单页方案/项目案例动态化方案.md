# 项目案例页面动态化方案（基于 ACF 与 WordPress 原生能力）

## 一、目标与原则

- 保持当前项目案例页面（Our Project）样式和布局完全不变，仅将静态内容改为动态数据输出  
- 只使用 ACF 插件与 WordPress 原生能力（Page、Options、媒体库、自定义文章类型等），不引入其他插件  
- 复用已有通用组件（`page-hero-title`、全局 CTA 按钮配置等），避免重复开发  
- 通过「全局默认 + 页面级覆盖」两层字段结构管理项目文案与项目列表  
- 为后续扩展项目案例为独立内容类型 / 跨页面复用列表预留空间  

---

## 二、涉及模板与模块梳理

### 2.1 页面与主模板

- 页面模板：`[page-project.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/page-project.php)`  
- 页面来源：`index-9.html`（Roll forming machine projects）

当前结构摘要：

- `<main>` 内部骨架：
  - `.ct-container-full` → `<article id="post-419">` → `.entry-content` → `.elementor.elementor-419`
- 模块调用：
  - Hero：`template-parts/components/page-hero-title.php`（传入 `'title' => 'Our Project'`）
  - 内容模块：
    - `template-parts/one_page/project-intro.php`
    - `template-parts/one_page/project-grid-1.php`
    - `template-parts/one_page/project-grid-2.php`
    - `template-parts/one_page/project-grid-3.php`

### 2.2 项目案例页面相关模块

1. 首屏 Hero 区（全站复用）
   - 组件：`template-parts/components/page-hero-title.php`  
   - 功能：展示 H1 标题「Our Project」，统一普通单页 Hero 的样式与高度  
   - 在《关于我们》《工厂》《FAQ》方案中已作为通用组件规划

2. 项目简介区 `project-intro.php`
   - 左列：
     - 小标题：`We Work With Global!`  
     - 主标题：`Sunway Completed Some Project For Our Foreign Clients`  
     - 一段说明：Sunway 如何通过方案帮助全球客户  
     - CTA 按钮：使用主题全局设置的 Footer CTA：
       - `get_option('elysia_footer_cta_button_url', home_url('/contact/'))`
       - `get_option('elysia_footer_cta_button_text', 'INQUIRY NOW')`
   - 右列：
     - 两张固定图片：`about-1-1.png`、`about-1-2.png`（叠加布局）

3. 项目栅格区 `project-grid-1.php` / `project-grid-2.php` / `project-grid-3.php`
   - 每个 `section` 为一组项目栅格，4 列等宽项目卡片  
   - 每个项目卡片结构相同：
     - 图片（来自 `static/image/*.jpg`）  
     - 分隔线（`elementor-widget-divider`）  
     - 地区文本（如 `Malaysia`、`The U.S.`、`Ethiopia` 等）  
     - 项目类型标题（如 `door machine`、`Racking Machine` 等）  
   - 栅格 1：Malaysia / Mexico / The U.S. / France  
   - 栅格 2：India / Bengal / Italy / India  
   - 栅格 3：Ethiopia / The U.S. / The U.S. / Next Destination（Waiting for you to consult）
   - 每个卡片大量使用 `hidefirst`、`animated-fast`、`elementor-invisible` 以及 `data-settings` 中的 `_animation` / `_animation_delay` 等属性控制动画

---

## 三、整体动态化设计思路

### 3.1 字段分层：全局默认 + 页面级覆盖

1. 全局层（Options Page）
   - 定义「项目案例全局设置」，用于：
     - 设置项目页面引用（供其他页面链接使用）  
     - 提供项目简介默认文案与右侧默认图片  
     - 提供默认项目列表（适用于多个站点或多语言共用的基础项目数据）

2. 页面层（Project 页面编辑页）
   - 在项目案例页面上挂载「项目案例页面设置」字段组，用于：
     - 覆盖项目简介区域文案与图片  
     - 覆盖项目列表（如为某语言单独配置不同案例时）  
   - 获取逻辑：页面级字段优先，全局 Options 字段兜底，最后回退到当前硬编码内容

### 3.2 模块级复用策略

- Hero 区 `page-hero-title`：
  - 完全复用已在 About / Factory / FAQ 等页面中规划的 `Page Hero 通用配置` 字段组（`hero_title` / `hero_subtitle` / `hero_background_image`）  
  - 项目案例页可通过 `hero_title` 设置「Our Project」或使用全局默认/页面标题

- 项目简介区 `project-intro`：
  - 左侧文案作为项目页私有内容，但字段设计为可复用结构（小标题 / 主标题 / 正文）  
  - CTA 按钮继续复用全站 Footer CTA 配置（`elysia_footer_cta_button_*`），避免为此页单独维护按钮文案/链接

- 项目栅格区 `project-grid-*`：
  - 三个模块结构高度一致，差别仅在数据  
  - 方案设计一个统一的「项目列表」数据结构（Repeater），不强行拆成三个字段组  
  - 在模板层按顺序将项目划分为三组，每组 4 个，保持现有布局  
  - 后续如需要在其他页面复用案例卡片列表，可基于同一数据源输出前 N 条

### 3.3 与其他页面的联动

1. 跳转到项目案例页
   - 在 Options 中增加 `project_page_ref` 字段（Post Object）指向项目案例页面  
   - 其他页面（如 About、Quality Manufacturing、Why Us）可通过此字段生成「查看更多项目案例」链接，避免硬编码 `/project/`

2. 与产品 / 解决方案页面的关联（预留）
   - 在项目数据结构中预留与产品或解决方案页面的关系字段，如：
     - `related_product`（Post Object，指向产品页面或 CPT）  
   - 未来可以在项目卡片中增加「查看对应产品」链接，不在当前阶段强制展示

3. 与 FAQ / 联系页面联动
   - 可在项目简介区或项目卡片区域新增「查看常见问题」或「联系我们」链接  
   - 链接目标分别从全局 `faq_page_ref` 与 `contact_page_ref` 字段中读取（在 FAQ/Contact 方案中已规划）

---

## 四、ACF 字段设计（全局 Options）

在 ACF 中（如「网站全局设置」 Options Page）添加字段组「项目案例全局设置」。

### 4.1 字段组：项目案例全局设置（global_project_settings）

位置：Options Page（如 `theme-general-settings`）

字段建议：

1. 项目案例页面引用
   - 字段名：`project_page_ref`  
   - 类型：Post Object（限制为 Page）  
   - 用途：为其他页面生成「查看项目案例」链接

2. 默认项目简介小标题
   - 字段名：`project_intro_badge_default`  
   - 类型：Text  
   - 默认值建议为当前文案 `We Work With Global!`

3. 默认项目简介主标题
   - 字段名：`project_intro_title_default`  
   - 类型：Text  
   - 默认值：`Sunway Completed Some Project For Our Foreign Clients`

4. 默认项目简介正文
   - 字段名：`project_intro_text_default`  
   - 类型：Textarea 或 Wysiwyg Editor  
   - 默认值为当前说明段落

5. 默认项目简介右侧大图
   - 字段名：`project_intro_image_main_default`  
   - 类型：Image  
   - 替代当前 `about-1-1.png`

6. 默认项目简介右侧小图
   - 字段名：`project_intro_image_secondary_default`  
   - 类型：Image  
   - 替代当前 `about-1-2.png`

7. 默认项目列表（全部项目数据）
   - 字段名：`project_items_default`  
   - 类型：Repeater  
   - 子字段设计：
     - `title`（Text）  
       - 如 `door machine`、`Racking Machine`
     - `country`（Text）  
       - 如 `Malaysia`、`The U.S.`、`Ethiopia`  
     - `image`（Image）  
       - 对应当前各项目图片  
     - `group`（Select / Number，可选）  
       - 用于标记所属栅格（1、2、3），便于按照现有布局切组  
       - 不填则按顺序自动分组  
     - `order`（Number，可选）  
       - 用于精细排序  
     - `highlight_text`（Text，可选）  
       - 如最后一个卡片的 `Waiting for you to consult`  
     - `link_type`（Select，可选）  
       - 值：`none` / `internal` / `external`  
     - `link_page`（Post Object，适用于 internal）  
     - `link_url`（URL，适用于 external）

> 初期可以在后台根据现有 14 个项目卡片录入一遍数据，严格对照当前文案和图片。

8. 默认每组卡片数量
   - 字段名：`project_items_per_group_default`  
   - 类型：Number  
   - 默认值：`4`（当前每组四列）

> 全局 CTA 按钮配置（`elysia_footer_cta_button_url` / `elysia_footer_cta_button_text`）已通过 `get_option` 使用，无需在本方案中重复定义，可继续沿用。

---

## 五、ACF 字段设计（项目案例页面字段组）

在使用 `page-project.php` 模板的页面上添加字段组「项目案例页面设置」。

### 5.1 字段组：项目案例页面设置（project_page_settings）

位置规则：

- Post Type = Page  
- 且 Page Template = 项目案例（或 Page = 对应 ID）

字段建议：

1. Hero 区覆盖（复用通用 hero 字段）

- 若已使用「Page Hero 通用配置」字段组（`hero_title` / `hero_subtitle` / `hero_background_image`），则无需重复定义  
- 项目页可以通过 `hero_title` 设置为「Our Project」，`hero_subtitle` 一句说明  

2. 项目简介覆盖字段

- 小标题：
  - 字段名：`project_intro_badge`（Text）  
  - 为空时使用 `project_intro_badge_default`

- 主标题：
  - 字段名：`project_intro_title`（Text）  
  - 为空时使用 `project_intro_title_default`

- 正文说明：
  - 字段名：`project_intro_text`（Textarea/Wysiwyg）  
  - 为空时使用 `project_intro_text_default`

- 右侧图片：
  - 大图：`project_intro_image_main`（Image）  
  - 小图：`project_intro_image_secondary`（Image）  
  - 为空时分别使用全局默认图片

3. 项目列表覆盖字段

- 字段名：`project_items`  
- 类型：Repeater  
- 子字段结构与全局 `project_items_default` 一致（title / country / image / group / order / highlight_text / link_type / link_page / link_url）  
- 数据优先级：
  1. 若页面级 `project_items` 有内容，则使用页面级数据  
  2. 否则使用全局 `project_items_default`

4. 项目卡片每组个数（可覆盖）

- 字段名：`project_items_per_group`  
- 类型：Number  
- 若为空则使用 `project_items_per_group_default`

---

## 六、各模块实现要点（逻辑层面）

以下为推荐逻辑，实际代码需在对应模板中实现，并在不破坏现有 class / data- 属性 / 动画设置的前提下替换内容。

### 6.1 Hero 区 `page-hero-title`（复用）

- 逻辑沿用《关于我们动态化方案》中描述的 `Page Hero 通用配置`：  
  - 优先读取当前页面的 `hero_title` / `hero_subtitle` / `hero_background_image`  
  - 若为空则回退到 Options 中的同名全局字段  
  - 若仍为空，`hero_title` 退回 `get_the_title()`  
- 项目案例页可设置特定的副标题，如「Selected Roll Forming Machine Projects Around The World」。

### 6.2 项目简介模块 `project-intro.php` 动态化

1. 文案数据获取

```php
$badge = get_field('project_intro_badge');
if (!$badge) {
    $badge = get_field('project_intro_badge_default', 'option');
}

$title = get_field('project_intro_title');
if (!$title) {
    $title = get_field('project_intro_title_default', 'option');
}

$text = get_field('project_intro_text');
if (!$text) {
    $text = get_field('project_intro_text_default', 'option');
}
```

2. 图片数据获取

```php
$image_main = get_field('project_intro_image_main');
if (!$image_main) {
    $image_main = get_field('project_intro_image_main_default', 'option');
}

$image_secondary = get_field('project_intro_image_secondary');
if (!$image_secondary) {
    $image_secondary = get_field('project_intro_image_secondary_default', 'option');
}
```

3. CTA 按钮

- 继续使用现有全局 Footer CTA 配置：

```php
$cta_btn_url  = get_option('elysia_footer_cta_button_url', home_url('/contact/'));
$cta_btn_text = get_option('elysia_footer_cta_button_text', __('INQUIRY NOW', 'elysia_first_web'));
```

- 不在此处引入新的 ACF 字段，确保全站营销入口统一

4. 前端结构

- 保留现有 Elementer 结构和 class 不变，只将 `<h5>`、`<h2>`、`<p>` 和 `<img>` 的内容替换为上述变量  
- 图片输出使用 `wp_get_attachment_image()` 或手工输出 `src/srcset/alt`，从 ACF Image 字段读取

### 6.3 项目栅格模块 `project-grid-1/2/3.php` 动态化

关键思路：  
使用统一的项目列表数据源，根据索引或 `group` 字段将项目分配到三个 `section` 中，以保持现有布局。

1. 数据获取（在每个 grid 模板中或在更高一层集中获取并传入）

```php
$items = get_field('project_items');
if (!$items) {
    $items = get_field('project_items_default', 'option');
}

$per_group = get_field('project_items_per_group');
if (!$per_group) {
    $per_group = get_field('project_items_per_group_default', 'option') ?: 4;
}
```

2. 按栅格分配项目

- `project-grid-1.php`：输出第 1 组项目（group=1 或列表第 1~4 个）  
- `project-grid-2.php`：输出第 2 组项目（group=2 或列表第 5~8 个）  
- `project-grid-3.php`：输出第 3 组项目（group=3 或列表第 9~12/14 个）  

示例切片逻辑（按顺序分配）：

```php
// 在某处根据当前 grid 确定组号，例如通过参数 $group_index
$offset = ($group_index - 1) * $per_group;
$group_items = array_slice($items, $offset, $per_group);
```

也可以根据 `group` 字段过滤：

```php
$group_items = array_filter($items, function($item) use ($group_index) {
    return isset($item['group']) && (int) $item['group'] === $group_index;
});
```

3. 单个项目卡片输出

- 对每个 `$group_items` 循环，输出与当前 HTML 完全一致的结构：
  - 图片：替换为 `$item['image']`  
  - 地区：`$item['country']`  
  - 标题：`$item['title']`  
  - 若存在 `highlight_text`，可替代标题或附加展示（如「Waiting for you to consult」）

4. 动画与样式保持

- 保持以下内容不变：
  - `elementor-element-xxx` 的 class 和 `data-id`（如需可保留原值，动态内容不依赖这些 ID）  
  - `hidefirst`、`animated-fast`、`elementor-invisible` 等动画相关 class  
  - `data-settings` 中的 `_animation` 和 `_animation_delay`  
- 如果在循环中很难保持每个卡片的 data-id 完全一致，可保留部分静态结构并仅替换内容，但推荐尽可能保持现有结构，避免影响现有 CSS/JS。

5. 项目卡片链接（可选）

- 若已填写 `link_type`：
  - `none`：不包裹链接  
  - `internal`：使用 `get_permalink($item['link_page'])`  
  - `external`：使用 `$item['link_url']`  
- 可选择用 `<a>` 包裹图片/标题，实现项目详情跳转

---

## 七、跨页面联动设计

结合其他已规划页面（About / Factory / FAQ / Contact），项目案例页可参与以下联动：

1. 项目案例页面引用 `project_page_ref`
   - 在 About / Factory / Quality Manufacturing 等页面中添加「查看更多项目案例」按钮时：  
     - 若 `project_page_ref` 已设置，则使用其链接  
     - 未设置时可回退到固定 `/project/` 或隐藏该按钮

2. 与 FAQ 页的联动
   - 在项目页面底部或某个项目栅格下，增加 CTA：「有疑问？查看常见问题」  
   - 链接目标从全局 `faq_page_ref` 字段获取（见 FAQ 动态化方案）

3. 与 Contact 页的联动
   - CTA 按钮继续沿用全局 Footer CTA 配置，从而与网站其他页面保持一致的询盘入口  
   - 如需特定项目询问入口，可将项目卡片链接到 Contact 页面并通过 URL 参数（如 `?project=malaysia-door-machine`）区分，属后续增强范围

4. 与产品/解决方案的联动（预留）
   - 项目数据中的 `related_product` 字段可在未来用于构建：
     - 项目详情页 → 产品详情页  
     - 产品详情页 → 项目案例列表（筛选与该产品相关的项目）

---

## 八、实施步骤建议

1. 在 ACF 中创建或扩展 Options Page（如「网站全局设置」），添加字段组「项目案例全局设置（global_project_settings）」及上述字段  
2. 在使用 `page-project.php` 模板的页面上创建字段组「项目案例页面设置（project_page_settings）」  
3. 确认 `page-hero-title.php` 已实现通用 Hero 字段逻辑，项目页只需调用即可  
4. 在 `[project-intro.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/one_page/project-intro.php)` 中：
   - 使用 ACF 字段替换小标题/主标题/正文/两张图片  
   - 按钮继续使用 `get_option('elysia_footer_cta_button_url/text')`，不做硬编码  
5. 在 `project-grid-1.php` / `project-grid-2.php` / `project-grid-3.php` 中：
   - 从统一的数据源（页面级 `project_items` 或全局 `project_items_default`）读取项目数组  
   - 按组号切片后循环输出项目卡片内容  
   - 保持所有动画 class 和 `data-settings` 属性不变  
6. 在 About / Factory 等页面中，如需增加「查看项目案例」入口：
   - 通过 `project_page_ref` 获取链接地址，避免硬编码  
7. 回到 WordPress 后台：
   - 在 Options 中录入默认项目简介和项目列表  
   - 在项目页面中按需要覆盖字段  
   - 手工对比静态版和动态版页面，确认样式与动画一致，内容可通过 ACF 灵活调整

---

通过以上方案，项目案例页面能够在不改变现有视觉和交互的前提下，实现灵活的内容管理和跨页面联动，并为未来扩展到独立项目内容体系打下基础。

