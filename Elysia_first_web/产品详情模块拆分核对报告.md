# 产品详情模块拆分核对报告

---

## 一、拆分清单表格（逻辑区块 → 建议模块）

> 说明：  
> - “建议文件名”统一以 `template-parts/product_detail/` 为归属目录来命名，便于在 Woo 单品模板中集中管理。  
> - “重用性评估”基于《模块映射.md》和《全站模块分析.md》，标注真正应该抽到 `components/` 或 `woocommerce/` 的模块，方便后续重构。

| 建议文件名（位于 `template-parts/product_detail/`） | 功能描述 | HTML 标识/锚点（原文件定位特征） | 重用性评估 |
| --- | --- | --- | --- |
| `product-breadcrumbs.php` | 产品详情页顶部面包屑导航，展示 Home → 类目 → 当前产品路径 | `section[data-id="44565186"] nav.woocommerce-breadcrumb`（`woocommerce/single-product.php` 顶部区域） | 全站通用模块，建议最终抽象为 `template-parts/components/breadcrumbs.php`，在 Woo 单品、Solution 列表/详情等多处复用 |
| `product-gallery.php` | 左侧产品图片画廊，包含主图与缩略图展示 | `section[data-id="6c1ac67b"]` 下 `<div class="elementor-widget-woocommerce-product-images">` 内部的 `get_template_part('template-parts/woocommerce/product', 'gallery')` | 页面类型私有（Single Product），已在文档中声明为 `product-gallery`，推荐长期放在 `template-parts/woocommerce/product-gallery.php` |
| `product-hero-summary.php` | 右侧产品标题（H1）、分类 Meta、短描述组合成的首屏摘要区域 | `section[data-id="6c1ac67b"]` 右列：`.elementor-widget-woocommerce-product-title`、`.elementor-widget-woocommerce-product-meta`、`.woocommerce-product-details__short-description` | 页面类型私有模块，仅用于产品详情首屏，可按需拆分为标题/Meta/摘要子模块，但暂不建议抽到全站 components |
| `product-usp-icons.php` | “Global Service / Design & Create / …” 三个 USP 图标+文案区块，强调服务优势 | `section[data-id="6c1ac67b"]` 内层 `section[data-id="14872236"]` 三列 `.elementor-widget-icon-box` | 页面类型私有模块，目前仅在该产品详情模板出现，可按产品详情专用组件处理 |
| `product-share-and-top-cta.php` | 首屏右侧的社交分享按钮（Email 等）+ 第一处 “Inquiry Now” 按钮 | `section[data-id="6c1ac67b"]` 右列内 `.elementor-widget-share-buttons` + 下方 `.elementor-widget-button`（Inquiry Now 链接至 `popup#343`） | 分享按钮本身属于“全站通用模块（`share-buttons`）”，引用应迁移至 `template-parts/components/share-buttons.php`；Inquiry 按钮为 Single Product CTA，可作为本页私有子块 |
| `product-tabs.php` | Woo 产品详情 Tabs（描述/参数/更多信息），承载核心产品字段内容 | `section[data-id="6ff59493"]` 左列 `.elementor-widget-woocommerce-product-data-tabs` 内部 `get_template_part('template-parts/woocommerce/product', 'tabs')` | 页面类型私有模块 `product-tabs`，根据文档建议长期放在 `template-parts/woocommerce/product-tabs.php`，不建议升为全站组件 |
| `product-faq.php` | 产品详情页下方 FAQ 手风琴，回答采购/售后等常见问题 | 同一左列下 `.elementor-widget-eael-adv-accordion` 的 `.eael-adv-accordion` 结构 | 页面类型私有模块，目前仅该产品详情内使用；全站还有独立 FAQ 单页，但结构与字段不同，暂不抽为通用 components |
| `product-inquiry-section.php` | Tabs + FAQ 区块结尾的 “Inquiry” 标题，作为主体内容内的询盘引导 | 左列 `h3.elementor-heading-title`，文本为 `Inquiry` | 页面类型私有模块，可与 FAQ 组合为“内容区结尾 CTA”，仅在产品详情使用 |
| `product-sidebar-toc-and-categories.php` | 右侧栏：Table of Contents（目录）+ 产品分类列表 | `section[data-id="6ff59493"]` 右列 `.elementor-widget-table-of-contents` + `.widget_product_categories` | TOC 为“全站可复用模块（`toc`）”，应最终抽象为 `template-parts/components/toc.php`，在产品详情、Solution 详情、Blog 详情等共用；分类列表属 Woo 页面族（归档/详情）可复用模块，但主要在产品相关页出现，优先作为 Woo 专用组件 |
| `product-sidebar-inquiry-card.php` | 右侧栏底部粘性 “Inquiry Now” 卡片：图标、说明文案、按钮 | 同一右列内 `section[data-id="50344f32"]` 内的 H2 “Inquiry Now” + 图标 SVG + 文本 + “Inquiry Now” 按钮 | 页面类型私有模块，但功能上依赖全站级 `popup-product-inquiry` 弹窗（文档第 18 点），建议与弹窗策略统一设计 |
| `product-related-products.php` | 页面底部 Related products 区块：4 个产品卡片，指向其他相关产品 | 顶层 `section[data-id="80d620e"]` 内 `<section class="related products">` 与 `ul.products` 列表，各 `<li class="product type-product">` | 区块本身属 Single Product 页面类型模块；但内部“产品卡片”应复用全站 `card-product` 组件（`template-parts/loop/card-product.php`），与产品归档、首页推荐产品等共用 |

小结：

- 真正“全站通用”的，是 `breadcrumbs / share-buttons / toc / card-product` 这类组件。  
- `product-gallery / product-tabs / product-faq / 侧边 Inquiry 卡 / hero-summary` 等属于 Single Product 页面私有模块。  
- 报告中将它们暂时统一描述为位于 `template-parts/product_detail/` 下，后续可以按文档目录要求平移到 `components/` 或 `woocommerce/`。

---

## 二、拆分后的 `single-product.php` 结构预览

下面是一个「拆分完成后」的结构示意，展示如何用 `get_template_part()` 重组产品详情页。  
（仅为结构预览，不包含所有属性/样式）

```php
<?php
get_header();
?>

<main id="main" class="site-main hfeed" itemscope="itemscope" itemtype="https://schema.org/CreativeWork">

    <div class="woocommerce-notices-wrapper"></div>

    <div class="elementor elementor-598 elementor-location-single product"
         data-elementor-type="product"
         data-elementor-id="598"
         data-elementor-post-type="elementor_library">

        <?php get_template_part('template-parts/components/breadcrumbs'); ?>

        <section class="elementor-section elementor-top-section elementor-section-boxed elementor-section-height-default">
            <div class="elementor-container elementor-column-gap-default">
                <div class="elementor-column elementor-col-50 elementor-top-column">
                    <div class="elementor-widget-wrap elementor-element-populated">
                        <?php get_template_part('template-parts/woocommerce/product', 'gallery'); ?>
                    </div>
                </div>

                <div class="elementor-column elementor-col-50 elementor-top-column">
                    <div class="elementor-widget-wrap elementor-element-populated">
                        <?php get_template_part('template-parts/product_detail/product', 'hero-summary'); ?>
                        <?php get_template_part('template-parts/product_detail/product', 'usp-icons'); ?>
                        <?php get_template_part('template-parts/components/share-buttons'); ?>
                        <?php get_template_part('template-parts/product_detail/product', 'top-cta'); ?>
                    </div>
                </div>
            </div>
        </section>

        <section class="elementor-section elementor-top-section elementor-section-boxed elementor-section-height-default">
            <div class="elementor-container elementor-column-gap-default">
                <div class="elementor-column elementor-col-50 elementor-top-column">
                    <div class="elementor-widget-wrap elementor-element-populated">
                        <?php get_template_part('template-parts/woocommerce/product', 'tabs'); ?>
                        <?php get_template_part('template-parts/product_detail/product', 'faq'); ?>
                        <?php get_template_part('template-parts/product_detail/product', 'inquiry-section'); ?>
                    </div>
                </div>

                <div class="elementor-column elementor-col-50 elementor-top-column">
                    <div class="elementor-widget-wrap elementor-element-populated">
                        <?php get_template_part('template-parts/components/toc'); ?>
                        <?php get_template_part('template-parts/product_detail/product', 'sidebar-categories'); ?>
                        <?php get_template_part('template-parts/product_detail/product', 'sidebar-inquiry-card'); ?>
                    </div>
                </div>
            </div>
        </section>

        <?php get_template_part('template-parts/product_detail/product', 'related-products'); ?>

    </div>

</main>

<?php
get_footer();
```

要点：

- 面包屑、分享按钮、TOC 等直接调用全站组件目录：`template-parts/components/`。  
- 产品画廊、Tabs 仍然沿用 `template-parts/woocommerce/` 下已有的 `product-gallery.php` 与 `product-tabs.php`。  
- 其它仅出现在产品详情页的结构，可以暂时归类在 `template-parts/product_detail/`，通过前缀 `product-` / `sidebar-` / `related-` 等区分职责。

---

## 三、拆分过程中的核心注意项

- WooCommerce 全局变量 `$product`  
  - 与当前商品数据强相关的模块（画廊、Tabs、价格/属性展示、相关产品查询）都需要依赖 `global $product;`。  
  - 在对应模板片段内部使用 Woo 官方 API，如 `wc_get_product()`, `$product->get_id()`, `$product->get_price_html()` 等，而不要写死 ID。

- WooCommerce Hooks 保留与兼容性  
  - 若后续从 Elementor 导出的静态结构迁移到 Woo 官方模板结构，建议在合适位置预留或插入：  
    - `do_action( 'woocommerce_before_single_product' );`  
    - `do_action( 'woocommerce_before_single_product_summary' );`  
    - `do_action( 'woocommerce_single_product_summary' );`  
    - `do_action( 'woocommerce_after_single_product_summary' );`  
    - `do_action( 'woocommerce_after_single_product' );`  
  - 在拆分为多个 `get_template_part()` 后，务必保证这些 Hook 的触发顺序与 Woo 默认模板尽量接近，避免插件或后续自定义函数失效。

- 组件目录与页面私有目录的边界  
  - 报告中标记为“全站通用”的模块（`breadcrumbs / share-buttons / toc / card-product`）应逐步迁移到 `template-parts/components/`，并在 Blog / Solution / Woo 模板统一调用。  
  - “Single Product 专用”模块（如 `product-hero-summary / product-faq / product-sidebar-inquiry-card`），可暂留在 `template-parts/product_detail/`，在确认其它页面确有同构结构之前不必强行抽象。

- Elementor 输出与语义化模块的对应关系  
  - 当前 HTML 大量带有 `data-id` 的 Elementor section/column/widget；拆分时以“业务意义”而不是“每个 widget”为粒度：  
    - 一个完整的“右侧吸顶 Inquiry 卡”对应一个模块，而不是拆成三个（标题/图标/按钮）。  
    - FAQ 的整组手风琴视为一个模块，而不是按问题拆模块。  
  - 模块命名优先使用语义化英文（`product-faq`, `product-sidebar-inquiry-card`），与文档命名风格保持一致。

- 相关产品区块与 `card-product` 复用  
  - 目前 Related products 是完全静态的 `<li class="product">` 列表；后续在改造时，可以：  
    - 使用 Woo 默认 `woocommerce_output_related_products` 或自定义查询生成相关产品列表；  
    - 在 Loop 中调用 `get_template_part('template-parts/loop/card-product');` 复用统一的产品卡片组件。

