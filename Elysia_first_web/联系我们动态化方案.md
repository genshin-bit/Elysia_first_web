# 联系我们页面动态化方案（基于 ACF 与原生功能）

本文档基于现有代码结构设计一个「联系我们」页面动态化方案，要求：

- 仅使用 ACF 插件和 WordPress 原生功能
- 保持现有前端样式与结构不破坏
- 支持组件复用（尤其是 Zoho 表单组件）与其它页面联动

涉及的主要文件：

- 页面模板：[page-contact.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/page-contact.php)
- 联系我们区块：
  - 头图区：[template-parts/one_page/contact-hero.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/one_page/contact-hero.php)
  - 四列联系方式：[template-parts/one_page/contact-info-grid.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/one_page/contact-info-grid.php)
  - 表单区：[template-parts/one_page/contact-form-and-map.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/one_page/contact-form-and-map.php)
- Zoho 表单组件（已拆出）：[template-parts/components/contact-form-zoho.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/components/contact-form-zoho.php)
- 资源引入文件：[template-parts/one_page/contact-assets.php](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/one_page/contact-assets.php)

---

## 一、现状概述

1. **模板结构**
   - `page-contact.php` 中使用 `get_template_part` 组合三个区块，并通过 `contact-assets.php` 注入与 swforming 原页面一致的 CSS/JS。
   - 主要内容区块完全由静态 HTML 写死，例如标题「Contact」、四列联系方式的文案和图标、表单文案等。

2. **Zoho 表单**
   - 已拆为组件 `template-parts/components/contact-form-zoho.php`，内部直接输出 Zoho iframe。
   - 联系我们页面底部通过：
     `get_template_part('template-parts/components/contact-form-zoho');`
     引入，便于后续在产品 CTA、Blog 侧栏等位置复用。

3. **资源引入**
   - `contact-assets.php` 中集中引入了 swforming 联系页所需的所有 CSS/JS 和内联样式，保证视觉效果一致。
   - 当前仅在 `page-contact.php` 中引用一次，作用范围限定在联系我们页面。

目标是在不破坏上述结构的前提下，将文案和部分配置改为可在后台（ACF）编辑，并为后续复用打好数据模型基础。

---

## 二、整体动态化设计原则

1. **模块级动态化，而非重新发明布局**
   - 保留 Elementor 导出的 HTML 结构和 class（如 `.elementor-155`、`.elementor-element-b36e830` 等），避免重新写 CSS。
   - 仅将可变的内容（文案、联系方式、表单文案等）抽取为 ACF 字段。

2. **字段分层**
   - 页面级字段（Page-level）：绑定到「联系我们」这一页的 ACF 字段组，用于控制本页的标题、副标题、说明文案等。
   - 选项级字段（Options-level）：使用 ACF Options Page 或 `options` 页面，存放「公司通用联系信息」，便于其它页面复用。

3. **组件化复用**
   - Zoho 表单组件：只在 `contact-form-zoho.php` 中维护 iframe 地址与公共属性，所有使用场景仅通过 `get_template_part` 引用。
   - 联系方式卡片：在 ACF 中定义可重复字段（Repeater），为将来在其它页面复用「联系方式卡片组件」预留数据模型。

4. **与其它页面联动**
   - 产品列表 CTA、产品详情页、Blog 侧栏等所有与「联系/询盘」相关区域，统一使用：
     - 相同的 Zoho 表单组件
     - 相同的核心联系信息字段（Tel、Email、WhatsApp、Address）

---

## 三、ACF 字段设计

### 3.1 字段组一：联系我们页面字段（绑定 Page: 联系我们）

**字段组：Contact Page Settings**

条件：`Post Type = Page` 且 `Page Template = 联系我们 (page-contact.php)`

字段建议：

1. `contact_hero_title`
   - 类型：Text
   - 用途：顶部大标题（默认值 `Contact`）
   - 使用位置：`contact-hero.php` 中 `<h1>` 文本

2. `contact_intro_subtitle`
   - 类型：Text
   - 用途：表单区左侧小标题（默认值 `get in touch`）
   - 使用位置：`contact-form-and-map.php` 中 `<h5>`

3. `contact_intro_title`
   - 类型：Text
   - 用途：表单区左侧主标题（默认值 `Get Quote & Leave us message`）
   - 使用位置：`contact-form-and-map.php` 中 `<h2>`

4. `contact_intro_description`
   - 类型：Textarea
   - 用途：表单区说明文案（默认值为目前英文段落）
   - 使用位置：`contact-form-and-map.php` 中 `<p>`

5. `contact_cards`（可选：为四列卡片做页面特有配置）
   - 类型：Repeater（最小行数 4，最大行数 4，以防破坏现有布局）
   - 子字段：
     - `label`（Text）：展示名称（如 Tel / Email / WhatsApp / Address）
     - `value`（Text 或 Textarea）：对应内容（电话、邮箱、地址等）
     - `link`（URL，可选）：如 Email 卡片点击后的链接
   - 若不启用 Repeater，可退回使用全局选项字段（见 3.2）填充。

> 说明：为了保持当前布局与图标不变，图标 SVG 仍然写死在模板中，只动态替换文本和链接。

### 3.2 字段组二：公司联系信息（ACF Options Page，全站共享）

**字段组：Global Contact Info**

位置：Options Page（例如：`主题设置 > 公司信息`）

字段建议：

1. `global_tel_label`（Text，默认 `Tel`）
2. `global_tel_number`（Text）
3. `global_email_label`（Text，默认 `Email`）
4. `global_email_address`（Email）
5. `global_whatsapp_label`（Text，默认 `WhatsApp`）
6. `global_whatsapp_number`（Text）
7. `global_address_label`（Text，默认 `Address`）
8. `global_address_text`（Textarea）

用途：

- 联系我们页面四列卡片的默认数据来源
- 产品页侧栏、Blog 侧栏等其它位置显示联系方式时，直接使用相同字段，保持全站一致。

### 3.3 字段组三：Zoho 表单配置（Options，可选）

**字段组：Zoho Form Settings**

字段建议：

1. `zoho_form_src`
   - 类型：URL
   - 默认值为当前 iframe 的 src 地址
   - 使用位置：`contact-form-zoho.php` 中的 `src` 属性

2. `zoho_form_height`
   - 类型：Number
   - 默认值：500
   - 使用位置：`style="height:...px"`，便于调整不同使用场景的高度

这样后续如果 Zoho 表单链接变更，只需在后台选项里改一次即可，全站所有使用该组件的地方都会更新。

---

## 四、模板改造方案

改造原则：仅替换文本输出为 ACF 调用，不改 class、不改结构。

以下代码片段仅示意调用方式，实际修改时需按现有结构插入。

### 4.1 page-contact.php

现状（节选）：

```php
<?php get_template_part('template-parts/one_page/contact-assets'); ?>

<main id="main" class="site-main hfeed">
    <div class="ct-container-full" data-content="normal">
        <article id="post-155" class="post-155 page type-page status-publish hentry">
            <div class="entry-content is-layout-constrained">
                <div data-elementor-type="wp-page" data-elementor-id="155" class="elementor elementor-155" data-elementor-post-type="page">
                    <?php
                    get_template_part('template-parts/one_page/contact-hero');
                    get_template_part('template-parts/one_page/contact-info-grid');
                    get_template_part('template-parts/one_page/contact-form-and-map');
                    ?>
                </div>
            </div>
        </article>
    </div>
</main>
```

此文件已经是完全模块化结构，无需再做改造，仅需确保：

- 联系我们页面的模板选择为「联系我们」
- 未来若新增其它联系相关区块，可以继续使用 `get_template_part` 方式追加。

### 4.2 contact-hero.php（顶部标题动态化）

现状简化：

```php
<h1 class="elementor-heading-title elementor-size-default">Contact</h1>
```

改造思路：

- 使用 `get_field('contact_hero_title')` 获取当前页面的标题
- 若字段为空，则回退到 `Contact`

示意：

```php
$hero_title = get_field('contact_hero_title');
?>
<h1 class="elementor-heading-title elementor-size-default">
    <?php echo $hero_title ? esc_html($hero_title) : 'Contact'; ?>
</h1>
```

### 4.3 contact-info-grid.php（四列联系方式动态化）

现状：四列卡片的标题和内容写死：

- `Tel` + `+86-13616182007`
- `Email` + 邮件地址
- `WhatsApp` + 同电话号码
- `Address` + 地址文本

改造思路有两种，可以组合使用：

1. 优先使用页面级 Repeater（`contact_cards`）：
   - 如果当前页面配置了 `contact_cards`，则依次输出四列卡片的 label 和 value。
2. 否则回退到全局选项字段（`global_tel_number` 等）。

在模板中，可以按以下顺序尝试：

```php
$cards = get_field('contact_cards');

if ($cards) {
    // 遍历 Repeater，输出四列内容，但保留原来的 SVG 图标和布局
} else {
    // 使用 get_field('global_tel_number', 'option') 等全局字段填充文本部分
}
```

SVG 图标部分保持不动，只替换：

- `<span>Tel</span>` 这类标题文本
- `<p class="elementor-icon-box-description">...</p>` 中的具体内容
- Email 卡片中的链接 href 和显示文字

### 4.4 contact-form-and-map.php（表单区文案动态化）

现状简化：

```php
<h5 class="elementor-heading-title elementor-size-default">get in touch</h5>
<h2 class="elementor-heading-title elementor-size-default">Get Quote & <br>Leave us message</h2>
<p>Have any questions, want to get the newest quote, or any other issue? ...</p>
<?php get_template_part('template-parts/components/contact-form-zoho'); ?>
```

改造思路：

- `get_field('contact_intro_subtitle')` → `<h5>` 文本
- `get_field('contact_intro_title')` → `<h2>` 文本
- `get_field('contact_intro_description')` → `<p>` 文本
- 表单 iframe 仍然从组件引入，不在此模板中写死。

示意：

```php
$subtitle = get_field('contact_intro_subtitle');
$title = get_field('contact_intro_title');
$description = get_field('contact_intro_description');
?>
<h5 class="elementor-heading-title elementor-size-default">
    <?php echo $subtitle ? esc_html($subtitle) : 'get in touch'; ?>
</h5>
<h2 class="elementor-heading-title elementor-size-default">
    <?php echo $title ? wp_kses_post($title) : 'Get Quote & <br>Leave us message'; ?>
</h2>
<p>
    <?php echo $description ? esc_html($description) : 'Have any questions, want to get the newest quote, or any other issue? Leave us a message, and we will reply within 12-48h.'; ?>
</p>
<?php get_template_part('template-parts/components/contact-form-zoho'); ?>
```

### 4.5 contact-form-zoho.php（表单配置动态化，可选）

现状：

```php
<iframe aria-label="Sunway Contact Form" frameborder="0" allow="geolocation;" style="height:500px;width:99%;border:none;" src="https://formscn.zohopublic.com.cn/easyceotech/form/SunwayContactForm/formperma/pzNRX0a0vTLnd9POzzlI5FD2DQm4WX5_ZfrCo5BuWow"></iframe>
```

可选改造：

- 使用 `get_field('zoho_form_src', 'option')` 获取 src
- 使用 `get_field('zoho_form_height', 'option')` 控制高度（默认为 500）

示意：

```php
$src = get_field('zoho_form_src', 'option');
$height = get_field('zoho_form_height', 'option');
if (!$height) {
    $height = 500;
}
?>
<iframe aria-label="Sunway Contact Form"
        frameborder="0"
        allow="geolocation;"
        style="height:<?php echo (int) $height; ?>px;width:99%;border:none;"
        src="<?php echo esc_url($src ? $src : 'https://formscn.zohopublic.com.cn/easyceotech/form/SunwayContactForm/formperma/pzNRX0a0vTLnd9POzzlI5FD2DQm4WX5_ZfrCo5BuWow'); ?>"></iframe>
```

---

## 五、组件复用与其它页面联动

### 5.1 Zoho 表单组件复用

当前已存在的组件 `contact-form-zoho.php` 可以在以下位置复用：

1. 产品列表 CTA 区
   - 在 `template-parts/product/archive-contact-us-cta.php` 或类似文件中插入：
     `get_template_part('template-parts/components/contact-form-zoho');`

2. 产品详情页侧栏
   - 在 `template-parts/product_detail/product-sidebar-inquiry-card.php` 中调用同一组件。

3. Blog 侧栏 CTA
   - 在 `template-parts/blog/blog-sidebar-contact.php`（若新增）或现有 CTA 模块里，同样调用该组件。

所有这些位置的宽度、高度和样式都由页面自身的外围容器控制，表单内部仅负责内容显示。

### 5.2 全局联系信息联动

通过 Options Page 中的 `Global Contact Info` 字段：

- 联系我们四列卡片使用这些字段作为默认数据源。
- 产品详情页顶部或侧栏显示「Tel / Email / WhatsApp / Address」时，也使用同样字段。
- Blog 文章页底部的「Need help? Contact us」等 CTA 区域复用这些字段，保证全站联系方式统一。

优先级建议：

1. 若当前页面有自己的 `contact_cards` 配置，则优先使用页面级数据，以满足局部定制需求。
2. 否则回退到 Options 中的全局字段。

### 5.3 其它语言或站点扩展

若后续需要多语言支持：

- 可使用 ACF 的多语言能力（配合 TranslatePress 或 WPML 等插件）对字段做翻译。
- 本方案核心依赖的是 ACF 和 WordPress 原生功能，未引入任何额外依赖。

---

## 六、实施步骤建议

1. 在测试环境安装并启用 ACF（Advanced Custom Fields）。
2. 创建字段组：
   - Contact Page Settings（绑定联系我们模板）
   - Global Contact Info（Options Page）
   - Zoho Form Settings（Options Page，可选）
3. 按第四部分方案逐步改造：
   - 先改造 `contact-hero.php` 和 `contact-form-and-map.php`
   - 再改造 `contact-info-grid.php`，加入字段回退逻辑
   - 最后可选地动态化 `contact-form-zoho.php`
4. 后台录入数据：
   - 在 Options Page 填写全局电话、邮箱、地址等
   - 在联系我们页面填写特定文案（如需要与其它页面区分）
5. 全站联动改造：
   - 在产品、Blog 相关模板中引入 Zoho 表单组件
   - 接入全局联系字段，替换原有硬编码文案
6. 验证：
   - 检查联系我们页面样式与之前保持一致
   - 修改 Options 中的电话或邮箱，确认相关页面联动更新

---

## 七、小结

通过以上方案：

- 联系我们页面保持与 swforming 原页面一致的视觉效果和 HTML 结构。
- 使用 ACF 与原生 API，将关键文案、联系方式和表单配置动态化。
- Zoho 表单组件可在全站范围内复用，后续如果表单地址或高度调整，仅需在一个地方修改。
- 所有改动均限制在现有模板体系内，不引入新插件，也不破坏当前的模块化拆分结构。

