# 文章列表模块拆分核对报告（page-blog.php）

---

## 一、拆分清单表格（逻辑区块 → 建议模块）

> 说明：  
> - 结合《模块映射.md》《工程实现导向.md（新闻相关页面）》中对 Blog Index 的定位：  
>   - 列表页核心是：首屏标题区 + 主文章列表 + 分页 + 可选侧边栏/分享区 + “热门/推荐”文章区块。  
>   - 文章卡片建议统一复用 `template-parts/loop/card-post.php`，而不是为本页单独造卡片模块。  
> - “建议文件名”统一以 `template-parts/blog/` 为归属目录来命名，仅承载本页面私有布局与逻辑；跨页面通用部分仍放在 `components/` / `loop/` 目录。

### 1. 区块级模块清单

| 建议文件名（位于 `template-parts/blog/`） | 功能描述 | HTML 标识/锚点（原文件定位特征） | 重用性评估 |
| --- | --- | --- | --- |
| `blog-hero.php` | Blog 列表页首屏标题区，仅显示 “Blog” 大标题和背景覆盖，统一列表页的首屏高度与标题样式 | `section.elementor-section[data-id="e507724"]` 内 `h1.elementor-heading-title` 文本为 `Blog` | 页面类型公共模块（Blog 列表专用），可在 `index.php`/`home.php` 重用，暂留在 `template-parts/blog/`，不抽到 `components/` |
| `blog-loop-recent-stories.php` | 主列表区块：“On Top / Recent Stories” 标题 + 左侧文章列表容器；列表内部实际应由 WordPress Loop 动态输出多篇文章，每篇使用 `card-post` | `section.elementor-section[data-id="55090a3e"]` 左列 `.elementor-element-69e526d6` 下方的 `On Top` 分割线、`Recent Stories` 标题、`.elementor-widget-posts[data-id="c35a416"]` 内部的 `.elementor-posts-container` | 页面类型私有模块（Blog 列表），但内部文章卡片应改为使用 `template-parts/loop/card-post.php`，以在其它文章列表/推荐区复用 |
| `blog-pagination.php` | Blog 主列表底部的分页导航：上一页、页码数字、下一页按钮 | 同一 `data-id="c35a416"` 小部件内部的 `<nav class="elementor-pagination" aria-label="Pagination">`（原始静态 HTML 分页结构） | 分页为跨页面可复用模块。推荐最终改用全站 `template-parts/components/pagination.php`，当前可先通过 `get_template_part('template-parts/components/pagination')` 统一调用 |
| `blog-sidebar-share.php` | 右侧栏的 “Share This Page” 标题 + 多个社交分享按钮（Facebook/Twitter/LinkedIn/WhatsApp/Email），整体视为一个侧栏分享区域 | `section[data-id="55090a3e"]` 右列 `.elementor-element-df250c0` 内的 `h4.elementor-heading-title` 文本 `Share This Page` + `.elementor-widget-share-buttons[data-id="9d4bb6d"]` | 分享按钮属于全站通用模块类型（对标 `share-buttons`），但该区域为“页面右侧分享区”的特定布局。建议：按钮内部逻辑复用 `template-parts/components/share-buttons.php`，外层侧栏布局作为 `blog-sidebar-share.php` 保留在 `blog/` 目录 |
| `blog-sidebar-latest-headlines.php` | 右侧栏中靠下的 “Latest Headlines” 小列表：仅显示若干篇文章的标题与日期（不含摘要/缩略图），类似“最新文章”小挂件 | 同一右列中 `.elementor-widget-posts[data-id="909156a"]`（注：ID 示例，实际根据 DOM 为右列第二个 posts widget），内部 `<div class="elementor-posts-container">` 下若干 `article.elementor-post`，每条仅含标题和日期 | 页面类型私有模块，功能类似“最新文章”侧边挂件；未来若在其它页面（单篇详情、Solution 详情）复用，可再抽象为 `components/latest-posts-sidebar.php` |
| `blog-cta-start-business.php` | 主列表区域底部的 CTA 区：分割线文案 “Strat Our Business Now” + 标题 “Get In Touch With Sunway”，用于引导从 Blog 列表进入商务沟通 | `section.elementor-inner-section[data-id="49dd545c"]` 内部 `.elementor-widget-divider[data-id="a86b949"]` 与 `h3.elementor-heading-title` 文本 `Get In Touch With Sunway` | 页面私有模块，当前仅出现在 Blog 列表；若将来相同 CTA 出现在其它页面，可考虑抽象为 `components/cta-get-in-touch.php` |
| `blog-section-popular-stories.php` | 页面底部“Most Popular Stories” 区块：包含 “On Trend” 分割线、标题 “Most Popular Stories” 以及 4 列网格文章卡片（缩略图 + 标题 +简短摘要 + 阅读更多） | `section.elementor-section[data-id="3526778a"]` 内 `.elementor-widget-divider[data-id="105303ad"]`、`h2.elementor-heading-title` 文本 `Most Popular Stories`，以及 `.elementor-widget-posts[data-id="2a5a14fa"]` 内部 `.elementor-posts-container` | 页面类型私有模块（Blog 列表），但内部单个文章卡片仍建议复用 `card-post`，以保证与其它“相关文章/推荐阅读”区域一致 |

> 小结：  
> - 列表页的**文章卡片**应统一走 `template-parts/loop/card-post.php`，这是《模块映射.md》中明确的页面类型公共模块。  
> - `pagination` / `share-buttons` / `page-hero-title` 已在文档中被认定为跨页面可复用模块，应通过 `components` 目录统一，而非重复在 `blog/` 下写一套。  
> - 文章列表页特有的布局（如“Recent Stories + Sidebar”、“Most Popular Stories 区块”、“侧边 Latest Headlines 列表”等）可以收敛在 `template-parts/blog/` 下作为页面私有模块。

---

## 二、拆分后的 `page-blog.php` 结构预览

> 目标：让 `page-blog.php` 像你现在的 `woocommerce/single-product.php` 一样，只负责编排，不直接写大段 HTML。  
> 下面示例代码是“结构预览”，重点展示 `get_template_part()` 调用关系，具体实现会保持现有 Elementor 导出的 HTML 结构与 class，以便继续使用 `post-1345.css`、`widget-posts.min.css` 等样式。

```php
<?php
/**
 * Template Name: 文章列表
 *
 * Blog 页面模板（从 swforming/index-11.html 迁移）
 */

get_header();
?>

<link rel='stylesheet' id='elementor-post-1345-css'
      href='<?php echo get_template_directory_uri(); ?>/static/css/post-1345.css'
      media='all' />
<link rel='stylesheet' id='widget-posts-css'
      href='<?php echo get_template_directory_uri(); ?>/static/css/widget-posts.min.css'
      media='all' />

<script>
    window.okkiConfigs = window.okkiConfigs || [];
    function okkiAdd() {
        okkiConfigs.push(arguments);
    }
    okkiAdd("analytics", {
        siteId: "39166-9223",
        gId: "UA-238156102-34"
    });
</script>
<script async src="<?php echo get_template_directory_uri(); ?>/static/js/analyze.js"></script>

<main id="main" class="site-main hfeed" itemscope="itemscope"
      itemtype="https://schema.org/CreativeWork">

    <div data-elementor-type="archive"
         data-elementor-id="1345"
         class="elementor elementor-1345 elementor-location-archive"
         data-elementor-post-type="elementor_library">

        <?php
        // Blog 列表页首屏标题区（仅负责样式与“Blog”标题）
        get_template_part('template-parts/blog/blog', 'hero');
        ?>

        <section class="elementor-section elementor-top-section elementor-element elementor-element-55090a3e elementor-section-boxed elementor-section-height-default elementor-section-height-default"
                 data-id="55090a3e"
                 data-element_type="section"
                 data-settings='{"background_background":"classic"}'>
            <div class="elementor-container elementor-column-gap-default">
                <div class="elementor-column elementor-col-66 elementor-top-column elementor-element elementor-element-69e526d6"
                     data-id="69e526d6"
                     data-element_type="column">
                    <div class="elementor-widget-wrap elementor-element-populated">

                        <?php
                        // 左侧主文章列表区块（Recent Stories + 分页）
                        get_template_part('template-parts/blog/blog', 'loop-recent-stories');

                        // 分页：推荐内部调用 template-parts/components/pagination.php，
                        // 不在此处直接输出静态 HTML。
                        get_template_part('template-parts/components/pagination');
                        ?>

                    </div>
                </div>

                <div class="elementor-column elementor-col-33 elementor-top-column elementor-element elementor-element-df250c0"
                     data-id="df250c0"
                     data-element_type="column">
                    <div class="elementor-widget-wrap elementor-element-populated">

                        <?php
                        // 右侧栏：页面分享区块
                        get_template_part('template-parts/blog/blog', 'sidebar-share');

                        // 右侧栏：最新文章标题列表（Latest Headlines）
                        get_template_part('template-parts/blog/blog', 'sidebar-latest-headlines');
                        ?>

                    </div>
                </div>
            </div>
        </section>

        <?php
        // 主列表区域下方的 CTA（Start Our Business Now / Get In Touch With Sunway）
        get_template_part('template-parts/blog/blog', 'cta-start-business');

        // 页面底部“Most Popular Stories” 区块
        get_template_part('template-parts/blog/blog', 'section-popular-stories');
        ?>

    </div>
</main>

<?php
get_footer();
```

> 说明：  
> - 示例中保留了关键 `section` / `column` 的 `data-id` 和 class，使现有 CSS/Elementor 前端逻辑仍然生效。  
> - `blog-loop-recent-stories.php` / `blog-sidebar-latest-headlines.php` / `blog-section-popular-stories.php` 内部，应将静态 `article.elementor-post` 替换为 WordPress Loop，并在循环里调用 `get_template_part('template-parts/loop/card-post')`。  
> - 分页区块推荐由 `template-parts/components/pagination.php` 管理，`page-blog.php` 只调用一次 `get_template_part()` 即可。

---

## 三、拆分过程中的核心注意项

### 1. 全局变量与查询对象

- `global $wp_query;` / `global $post;`  
  - Blog 列表通常基于主查询（`is_home()`/`is_post_type_archive()`）输出文章列表；如在 `page-blog.php` 内使用自定义 `WP_Query`，应在模块内显式保存和恢复 `$wp_query` / `$post`，避免污染全局。  
  - 若使用 `query_posts()`（不推荐），拆分时需要考虑对全局查询状态的影响。

- `$paged` / `get_query_var('paged')`  
  - 分页逻辑依赖 `$paged`；`blog-loop-recent-stories.php` 应在内部使用 `paged` 参数构建查询，或直接使用主查询并在 `pagination` 模块中调用 `the_posts_pagination()` / `paginate_links()`。  
  - 拆分模块时，不要在多个模块内分别处理分页，以免重复输出或逻辑冲突。

### 2. WordPress Loop 与模板片段调用

- 文章卡片组件 `card-post`  
  - 根据《模块映射.md》，Blog 文章卡片应统一使用 `template-parts/loop/card-post.php`：  
    - `blog-loop-recent-stories.php` 中的主列表循环：  
      ```php
      if ( have_posts() ) {
          while ( have_posts() ) {
              the_post();
              get_template_part('template-parts/loop/card-post');
          }
      }
      ```  
    - `blog-sidebar-latest-headlines.php` / `blog-section-popular-stories.php` 中，如需自定义查询，可在各自模块内部使用 `WP_Query` 并在循环中同样调用 `card-post`，根据需要增加只显示标题/日期的展示层逻辑。  
  - 不建议在多个模块中复制 `article.elementor-post` 静态 HTML；应将表现层集中在 `card-post` 中统一维护。

- 避免重复调用 `have_posts()`  
  - 确保主循环只在一个模块中消费主查询；其它模块如需要文章列表，应使用单独的 `WP_Query`，并在结束后 `wp_reset_postdata()`。

### 3. 跨页面通用组件（来自《模块映射.md》）

- 分页 `pagination`  
  - 推荐统一使用 `template-parts/components/pagination.php`：  
    - 对应 Blog 列表、归档、产品归档等页。  
    - 模块内部负责调用 `the_posts_pagination()` 或自定义分页 HTML；`page-blog.php` 不再手写 `<nav class="elementor-pagination">`。  

- 分享按钮 `share-buttons`  
  - 当前 Blog 列表右侧的分享区块仅在本页使用，但按钮类型和样式与全站 share 模块一致。  
  - 建议在 `blog-sidebar-share.php` 中复用 `get_template_part('template-parts/components/share-buttons')`，只在外层控制标题和布局。

- Page Hero 标题区 `page-hero-title`（可选）  
  - 文档中建议在 `index.php`/`home.php`/`archive.php` 使用 `page-hero-title` 统一标题样式。  
  - 本次 Blog 列表已经有首屏 Hero 区（`Blog` 标题），可视需求决定未来是否改为复用 `template-parts/components/page-hero-title.php`，当前拆分可以继续视为 `blog-hero.php`，避免一次性改动过大。

### 4. 脚本与样式引入

- CSS/JS 引用保持在 `page-blog.php` 顶部：  
  - `post-1345.css`、`widget-posts.min.css`、`analyze.js` 等资源已经通过 `<link>` / `<script>` 写在模板顶部。  
  - 拆分模块时，不要在子模块中重复引入这些资源，以避免多次加载或冲突。  
  - 如后续优化，可将这部分迁移到 `functions.php` 通过 `wp_enqueue_style` / `wp_enqueue_script` 管理，但这属于后续工程优化范畴。

### 5. SEO 与可访问性细节

- 标题层级 `h1/h2/h3`  
  - 拆分 `blog-hero.php` / `blog-loop-recent-stories.php` / `blog-section-popular-stories.php` 时，需保持原有标题层级关系：  
    - 页面的主标题使用 `h1`（Blog）；  
    - 区块标题（“Recent Stories”、“Most Popular Stories”）使用 `h2`；  
    - 文章标题在卡片内使用 `h3`。  
  - 模块拆分时注意不要因为 `get_template_part()` 嵌套在不合理的容器中而打乱语义结构。

### 6. 与 WooCommerce Hooks 的关系说明

- 本模板为文章列表（Blog Index），不直接涉及 WooCommerce。  
- 因此：  
  - 不需要在本页面中考虑 `woocommerce_before_main_content` / `woocommerce_after_shop_loop` 等 Woo Hooks。  
  - 需要关注的是 WordPress 自身的模板层次和 Loop 行为，以及主题中可能存在的自定义 Hook（如在 `header.php` / `footer.php` 中挂载的全站组件）。  

---

## 四、总结与下一步建议

- 本报告已经根据 `page-blog.php` 实际 HTML 结构，将 Blog 列表拆分为 6 个主要模块：首屏 Hero、主列表 + 分页、右侧分享、右侧最新标题列表、列表区 CTA、底部热门文章区。  
- 与《模块映射.md》《工程实现导向.md》中关于 Blog Index 的规划对齐：  
  - 列表页核心逻辑集中在 `loop + card-post + pagination` 三者；  
  - 其它都是围绕这些核心的布局和装饰模块。  
- 下一步如果你希望，可以按照该表直接创建 `template-parts/blog/*.php` 模块文件，并将 `page-blog.php` 改造为仅负责编排的版本（类似已经完成的 `woocommerce/single-product.php` 拆分方式），同时用 `card-post` + `pagination` 替换当前静态文章和分页 HTML。  

