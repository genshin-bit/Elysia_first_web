# 文章详情模块拆分核对报告（page-blog-detail.php）

本文档基于 `page-blog-detail.php`（模板名：文章详情），并参照
[`模块映射.md`](file:///e:/phpstudy_pro/WWW/wp-content/themes/swforming/模块映射.md)
与[`全站模块分析.md`](file:///e:/phpstudy_pro/WWW/wp-content/themes/swforming/全站模块分析.md)，
对页面内的独立逻辑区块进行模块化拆分核对。

---

## 一、模块拆分清单

> 说明：
> - “建议文件名”优先放在 `template-parts/blog_detail/` 目录；
> - 对于已在 `template-parts/components/` 中抽象或应抽象为全站组件的部分，在“重用性评估”中单独标注。

| 序号 | 建议文件名 / 目标文件                         | 功能描述/职责                                                                 | HTML 标识 / 锚点示例                                                                                      | 重用性评估 |
| ---- | --------------------------------------------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- | ---------- |
| 1    | `template-parts/blog_detail/blog-detail-hero.php` | 文章详情首屏 Hero：输出文章标题、发布日期等基础信息，承接阅读入口。               | `section.elementor-top-section[data-id="41df9e55"]` 内含 `.elementor-widget-theme-post-title`、`.elementor-widget-post-info` | Blog 详情页私有（结构模式接近 `page-hero-title`，后续可与其它详情页统一为类型组件） |
| 2    | `template-parts/blog_detail/blog-detail-content.php` | 文章正文主内容：包含 Introduction 与 5 个 Case Study 等长文内容。               | 左侧列 `div.elementor-widget-theme-post-content[data-id="203c5bf4"]` 内所有 `<h2>/<h3>/<p>/<ul>/<table>` 等 | 本文内容私有（后续可替换为标准 `the_content()` 输出，成为通用 Blog 正文容器） |
| 3    | `template-parts/components/toc.php`           | 右侧“Table of Contents” 目录组件：根据正文标题结构自动生成目录树。                | `.elementor-widget-table-of-contents[data-id="731ebb56"]`，内部 `.elementor-table-of-contents` 容器      | 全站通用组件（`全站模块分析` 中的 `toc`，应抽象到 `template-parts/components/toc.php`） |
| 4    | `template-parts/components/share-buttons.php` | 右侧分享按钮区域：提供 Facebook / Twitter / LinkedIn / WhatsApp / Email 分享入口。 | `.elementor-widget-share-buttons[data-id="061fd7e"]`，内部 `.elementor-share-buttons-wrapper` + `.elementor-share-btn_*` | 全站通用组件（`全站模块分析` 中的 `share-buttons`，已在 Blog 列表页计划复用） |
| 5    | `template-parts/blog_detail/blog-detail-sidebar-latest.php` | 右侧 “New Update” 最新文章列表：以列表形式展示最近几篇 Blog。                   | `section.elementor-inner-section[data-id="5dd542a7"]` 内 `.elementor-widget-posts[data-id="25c6fc9a"]` 与 `article.elementor-post` | 跨页面可复用（Blog 相关文章列表），建议内部复用 `template-parts/loop/card-post.php` |
| 6    | `template-parts/blog_detail/blog-detail-sidebar-contact.php` | 右侧 “Start Our Business Now / Get In Touch With Sunway” 联系表单 CTA。        | `section.elementor-inner-section[data-id="243f0e4"]` 内 `div#zf_div_pzNRX0a0vTLnd9POzzlI5FD2DQm4WX5_ZfrCo5BuWow` + Zoho iframe 脚本 | 当前视为 Blog 详情页私有 CTA；若在 Solution/产品详情等页面重复，可进一步抽象为全站联系表单组件 |

---

## 二、拆分后 `page-blog-detail.php` 结构预览

> 目标：主模板 `page-blog-detail.php` 只做“编排与组合”，实际结构输出由各模块文件完成。

```php
<?php
/**
 * Template Name: 文章详情
 *
 * Blog 详情页模板（从 swforming/index-12.html 迁移）
 */

get_header();
?>

<link rel="stylesheet" id="widget-posts-css" href="<?php echo get_template_directory_uri(); ?>/static/css/widget-posts.min.css" media="all" />
<link rel="stylesheet" id="widget-divider-css" href="<?php echo get_template_directory_uri(); ?>/static/css/widget-divider.min.css" media="all" />
<link rel="stylesheet" id="widget-post-navigation-css" href="<?php echo get_template_directory_uri(); ?>/static/css/widget-post-navigation.min.css" media="all" />
<link rel="stylesheet" id="widget-table-of-contents-css" href="<?php echo get_template_directory_uri(); ?>/static/css/widget-table-of-contents.min.css" media="all" />
<link rel="stylesheet" id="elementor-post-1361-css" href="<?php echo get_template_directory_uri(); ?>/static/css/post-1361.css" media="all" />

<script>
    window.okkiConfigs = window.okkiConfigs || [];
    function okkiAdd() {
        okkiConfigs.push(arguments);
    }
    okkiAdd("analytics", {
        siteId: "39166-9223",
        gId: "UA-238156102-34"
    });
</script>
<script async src="<?php echo get_template_directory_uri(); ?>/static/js/analyze.js"></script>

<main id="main" class="site-main hfeed" itemscope="itemscope" itemtype="https://schema.org/CreativeWork">
    <div data-elementor-type="single-post" data-elementor-id="1361" class="elementor elementor-1361 elementor-location-single" data-elementor-post-type="elementor_library">

        <?php get_template_part('template-parts/blog_detail/blog-detail', 'hero'); ?>

        <section data-particle_enable="false" data-particle-mobile-disabled="false" class="elementor-section elementor-top-section elementor-element elementor-element-2d6a3b2 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="2d6a3b2" data-element_type="section">
            <div class="elementor-container elementor-column-gap-default">

                <div class="elementor-column elementor-col-50 elementor-top-column elementor-element elementor-element-2806ac2f" data-id="2806ac2f" data-element_type="column">
                    <div class="elementor-widget-wrap elementor-element-populated">
                        <?php get_template_part('template-parts/blog_detail/blog-detail', 'content'); ?>
                    </div>
                </div>

                <div class="elementor-column elementor-col-50 elementor-top-column elementor-element elementor-element-4cf90785" data-id="4cf90785" data-element_type="column">
                    <div class="elementor-widget-wrap elementor-element-populated">
                        <?php get_template_part('template-parts/components/toc'); ?>
                        <?php get_template_part('template-parts/components/share-buttons'); ?>
                        <?php get_template_part('template-parts/blog_detail/blog-detail', 'sidebar-latest'); ?>
                        <?php get_template_part('template-parts/blog_detail/blog-detail', 'sidebar-contact'); ?>
                    </div>
                </div>

            </div>
        </section>

    </div>
</main>

<?php
get_footer();
?>
```

> 说明：
> - 上述示例保留了原有 `Elementor` 的关键 `data-id` 与类名，避免样式/脚本失效；
> - TOC 与 Share Buttons 使用全站组件路径，Blog 详情页侧边栏其它部分放在 `blog_detail` 专用目录下。

---

## 三、核心注意项

- **全局变量与上下文**
  - 当前 `page-blog-detail.php` 为自定义“页面模板”，并非 `single.php` 兜底模板，正文内容是静态 HTML，而非 `the_content()`；
  - 若后续改造为真正的文章详情（基于 `post` 类型），需在模块内部显式使用 Loop（`have_posts()` / `the_post()`）以及 `the_title()` / `the_content()`，并保证全局 `$post` 上下文正确。

- **跨页面组件复用**
  - TOC、分享按钮属于 `全站模块分析` 中的通用组件，应统一抽象到 `template-parts/components/toc.php` 与 `template-parts/components/share-buttons.php`，避免在 Blog/产品/Solution 等多个详情页重复维护。
  - “New Update” 最新文章列表建议内部循环时复用 `template-parts/loop/card-post.php`，与 Blog 列表页的文章卡片保持一致。

- **Elementor 结构兼容性**
  - 在拆分至各模块文件时，必须原样保留关键 `data-id`、`data-element_type` 与类名（如 `.elementor-widget-theme-post-content`），以确保从 `swforming/index-12.html` 迁移的 CSS/JS 能继续生效。
  - 尤其是 TOC 组件，需要位于与正文同一页面结构内，才能正确扫描 `<h2>/<h3>` 标题生成目录。

- **静态资源与埋点脚本**
  - 页面顶部引入的若干 CSS（如 `widget-posts.min.css`、`widget-table-of-contents.min.css`）与 `okki` 埋点脚本当前直接写在模板中；
  - 后续可考虑移动到 `functions.php`（通过 `wp_enqueue_style()` / `wp_enqueue_script()`）统一管理，但在拆分模块时应保持现有加载顺序与依赖关系不变，避免影响样式与埋点数据采集。

