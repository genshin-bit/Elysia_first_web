**产品列表模块拆分核对报告（page-solution.php）**

---

**一、拆分清单表格**

> 说明：以下模块命名和重用性判断，综合参考了 swforming 主题中的 `全站模块分析.md` 与 `模块映射.md` 中类似模块的命名方式（如 `loop-solution-grid.php`、`card-product.php`），并结合当前 `page-solution.php` 的实际结构进行推断。

| 建议文件名（相对路径） | 功能描述 | HTML 标识 / 锚点（起始特征） | 重用性评估 |
| --- | --- | --- | --- |
| `template-parts/solution/solution-archive-header.php` | 解决方案列表页顶部区域：包含 Rank Math 面包屑 + 页面主标题“Solution”以及可能的简短描述或背景区域。用于告诉用户当前所在栏目。 | 包含 `<div class="rank-math-breadcrumb">` 以及紧随其后的 `Solution` 标题区域；通常在第一个 Elementor section 内。 | **全站通用（需移至 components 目录）**：建议抽象为通用“栏目页头部组件”，通过参数控制标题/副标题/背景，放到 `template-parts/components/archive-header.php` 一类位置。 |
| `template-parts/solution/layout-two-column-solution.php` | 解决方案列表页的整体两栏布局：左侧为解决方案列表（Loop）；右侧为“Feature Product”产品推荐区域。负责页面主栅格结构（Elementor 容器 + 两列结构），不含具体业务内容。 | 包裹解决方案列表与 Feature Product 的外层 `<section ... class="elementor-section ...">`，内部含两个 `elementor-column`，样式上为左右两列布局。 | **全站通用（需移至 components 目录）**：该两栏布局可在其它列表/详情页复用，建议抽象为布局组件，例如 `template-parts/components/layout-two-column.php`，通过 `get_template_part()` 时传递 slot 或通过 hook 填充左右内容。 |
| `template-parts/solution/loop-solution-grid.php` | 左侧“解决方案列表”主循环区域：包括 Elementor 导出的 Loop Container，内部包含 8 个解决方案卡片，以及底部分页导航（Pagination）。当前为静态 HTML，后续可改为 WP_Query。 | 包含 `<div class="elementor-loop-container elementor-grid" role="list">` 起始，到 `<nav class="elementor-pagination" aria-label="Pagination">` 结束；中间有多个 `class="e-loop-item ... solution type-solution"` 的卡片节点。 | **首页私有（页面私有）**：该 Loop 结构主要服务于解决方案列表页，不适合直接全站复用，保留在 `template-parts/solution/` 目录下即可。 |
| `template-parts/components/card-solution.php` | 单个解决方案卡片模块：包含标题、描述、按钮/链接、背景色与 hover 效果等。当前在 `elementor-loop-container` 内以 8 个几乎相同的 `data-elementor-type="loop-item"` 块存在。 | 以 `<div data-elementor-type="loop-item" data-elementor-id="5262" class="elementor elementor-5262 e-loop-item ... solution type-solution ...">` 为起点，内部是一个完整的 `<section ...>`，用于展示单条 solution 信息。 | **全站通用（需移至 components 目录）**：解决方案卡片在列表页、首页推荐区、相关解决方案模块中都可以复用，建议独立为 `template-parts/components/card-solution.php`，Loop 内通过 `get_template_part()` 引入。 |
| `template-parts/solution/solution-pagination.php` | 解决方案列表分页区域：负责显示“1 / 2 / 下一页”等分页链接，目前为 Elementor 导出的 `<nav class="elementor-pagination">`。后续可替换为 `the_posts_pagination()` 等 WP 原生分页。 | `<nav class="elementor-pagination" aria-label="Pagination">` 起始到其结束标签为止。通常紧跟在 loop container 之后。 | **首页私有（页面私有）**：该分页目前与解决方案列表绑定，样式、文案与本页紧密相关，可先保留在 `template-parts/solution/` 中；若之后多个列表页共享完全相同分页样式，再抽象为通用组件。 |
| `template-parts/components/sidebar-feature-product.php` | 右侧“Feature Product”模块：包含标题“Feature Product”和一个 WooCommerce 风格的产品网格（2 列），展示推荐产品。当前为静态 HTML（`<ul class="products elementor-grid columns-2" ...>` 列表）。 | 以标题块 `<h2 class="elementor-heading-title elementor-size-default">Feature Product</h2>` 起始，随后为 `<div class="woocommerce columns-2 ">` 和 `<ul class="products elementor-grid columns-2" data-products="type-1" data-hover="swap">` 直至该列表结束。 | **全站通用（需移至 components 目录）**：Feature Product 侧栏可在多处（解决方案列表、详情页、博客详情等）作为统一产品推荐区域复用，建议放到 `template-parts/components/sidebar-feature-product.php`。 |
| `template-parts/components/card-product.php` | 单个产品卡片模块：包含产品缩略图、标题、价格、按钮等 WooCommerce 产品信息。当前在 Feature Product 列表中以 `<li class="product ...">` 重复出现。 | Feature Product 内部的 `<li class="product ...">` 节点，每个 `<li>` 对应一个产品卡片。 | **全站通用（需移至 components 目录）**：产品卡片组件明显是全站通用模块，建议抽象为 `template-parts/components/card-product.php`，由产品列表（推荐/分类页/搜索结果）复用。 |
| `template-parts/solution/solution-page-wrapper.php`（可选） | 整个解决方案列表页的主内容 wrapper：承接 header、两栏布局、底部空白等，统一管理页面的 `<main>` 与容器类名。与 `page-solution.php` 顶层结构略有重叠，适合在同类“列表页”复用。 | 从 `<main id="primary" class="site-main">` 或 Elementor 第一个主要内容 `<section ...>` 起始，到本页面主内容结束的外层容器。 | **首页私有（页面私有）**：目前仅用于解决方案列表页。如未来有“案例列表/新闻列表”等同构页面，可将其升级为组件并挪至 `components`。 |

---

**二、拆分后的 `page-solution.php` 结构预览**

> 说明：以下为拆分完成后的结构示意，并非要求你立刻改动，只是展示目标结构。文件名与路径与上表保持一致，可根据实际 `模块映射.md` 进一步微调。

```php
<?php
/**
 * Template Name: Solution List
 */

get_header();
?>

<main id="primary" class="site-main">

    <?php
    // 顶部：面包屑 + 标题区域（建议最终迁入 components/archive-header）
    get_template_part( 'template-parts/solution/solution-archive-header' );
    ?>

    <div class="solution-archive-layout">
        <div class="solution-archive-layout__inner">
            <div class="solution-archive-layout__main">
                <?php
                // 左侧：解决方案列表 Loop（内部再细分为卡片 + 分页）
                get_template_part( 'template-parts/solution/layout-two-column-solution', null, array(
                    'position' => 'main',
                ) );
                ?>
            </div>

            <aside class="solution-archive-layout__sidebar">
                <?php
                // 右侧：Feature Product 侧栏（全站通用组件）
                get_template_part( 'template-parts/components/sidebar-feature-product' );
                ?>
            </aside>
        </div>
    </div>

</main>

<?php
get_footer();
```

**示例：`layout-two-column-solution.php` 内部进一步拆分**

```php
<?php
// template-parts/solution/layout-two-column-solution.php

// 左侧解决方案列表 loop（HTML 结构保持与 Elementor 导出一致，逐步替换为动态数据）
get_template_part( 'template-parts/solution/loop-solution-grid' );
```

**示例：`loop-solution-grid.php` 中使用通用卡片 + 分页**

```php
<?php
// template-parts/solution/loop-solution-grid.php

?>
<div class="elementor-loop-container elementor-grid" role="list">
    <?php
    // 未来可以替换为 WP_Query 循环；当前为静态结构时使用静态 include
    // while ( $solution_query->have_posts() ) :
    //     $solution_query->the_post();
        get_template_part( 'template-parts/components/card-solution' );
    // endwhile;
    ?>
</div>

<?php
// 分页区域（可保留 Elementor 导出的 nav 结构，也可改为 the_posts_pagination）
get_template_part( 'template-parts/solution/solution-pagination' );
```

**示例：`sidebar-feature-product.php` 中使用产品卡片**

```php
<?php
// template-parts/components/sidebar-feature-product.php

?>
<div class="elementor-widget-container">
    <h2 class="elementor-heading-title elementor-size-default">Feature Product</h2>
</div>

<div class="woocommerce columns-2 ">
    <ul class="products elementor-grid columns-2" data-products="type-1" data-hover="swap">
        <?php
        // 未来可使用 WooCommerce 查询获取推荐产品
        // while ( $products->have_posts() ) :
        //     $products->the_post();
            get_template_part( 'template-parts/components/card-product' );
        // endwhile;
        ?>
    </ul>
</div>
```

---

**三、核心注意项（拆分时必须特别留意）**

- **保持 Elementor 导出 HTML 结构、类名和 data 属性不变**  
  - 你的前提要求是“保持原始 HTML 结构、CSS 类名和 ID 完全不变”。  
  - 拆分为多个 `get_template_part()` 文件时，务必保证拆前拆后：  
    - `<section>` / `<div>` 结构层级不变；  
    - `class="elementor-section ..."`, `class="elementor-column ..."`, `data-elementor-id` 等属性原样保留；  
    - 不要在组件边界多包一层额外 `<div>`，否则会影响布局。

- **未来引入 WP_Query / Loop 时的全局变量处理**  
  - 如果将 solutions 列表改成动态查询：  
    - 使用 `WP_Query` 或 `query_posts()` 时，应在 loop 结束后调用 `wp_reset_postdata()`，防止影响后续模板。  
    - `card-solution.php` 内部可以假定 `$post` 已经是正确的 solution 对象，不要在卡片内部再次开启 query。  
    - 如在卡片内部需要使用 `get_the_permalink()`, `the_title()`, `the_excerpt()` 等函数，确保 loop 环境正确。

- **WooCommerce 环境与 `$product` 全局变量**  
  - Feature Product 区域如果将来改为调用 WooCommerce API：  
    - 标准写法依赖 `$product` 全局变量，如 `global $product;`。  
    - 注意在自定义查询中手动设置 `$product = wc_get_product( get_the_ID() );`。  
    - 拆分模板时，`card-product.php` 内不要重新查询产品，而是使用当前循环中的 `$product`。  
    - 如果使用 WooCommerce 模板函数（如 `woocommerce_template_loop_add_to_cart()`），须确保已调用 `wc_setup_product_data( $post )` 或使用标准 WooCommerce Loop。

- **Hook / Filter 的保留与位置**  
  - 若未来将 Elementor 导出的 HTML 替换为 WooCommerce 或 WordPress 官方模板函数，需要注意：  
    - 诸如 `do_action( 'woocommerce_before_shop_loop_item' )`, `do_action( 'woocommerce_after_shop_loop_item' )` 等 hook 必须在 `card-product.php` 中保持位置正确，否则插件／子主题扩展可能失效。  
    - 如果引入自定义的 action（例如 `do_action( 'swforming_solution_card_meta' )`），也应统一放在 `card-solution.php`，而非散落在多处模板文件中，方便维护。

- **模板参数与组件复用方式**  
  - 通用组件（例如 `archive-header`、`card-solution`、`card-product`）建议：  
    - 使用 `get_template_part( $slug, $name, $args )` 传递参数，如标题文案、背景图、是否显示按钮等；  
    - 在组件内部通过 `get_query_var()` 或 PHP 8+ 的 `$args` 变量读取参数；  
    - 避免在组件中硬编码路径或 ID，以提升复用效率。  
  - 对于 “全站通用（需移至 components 目录）” 的模块，注意：  
    - 文件应放在 `template-parts/components/` 目录下；  
    - 命名保持简洁清晰，例如 `card-solution.php`、`card-product.php`、`sidebar-feature-product.php` 等。

- **静态资源与路径问题**  
  - 当前 `page-solution.php` 中的图片/静态资源如果仍是硬编码路径：  
    - 拆分后仍要保持路径一致以保证视觉对比完全一致；  
    - 在未来改造为动态资源时，再统一替换为 `get_template_directory_uri()` 等函数，避免拆分阶段引入路径错误。

- **样式与脚本作用域**  
  - 如果在 `page-solution.php` 中存在内联 `<style>` 或 `<script>`（例如针对 `.elementor-loop-container` 的样式）：  
    - 拆分到对应模块文件时，尽量保持样式与 HTML 成对出现，避免样式脱离其语义模块导致调试困难。  
    - 若这些样式/脚本在多个页面复用，建议在拆分阶段顺带识别并迁移到统一 CSS/JS 文件中，保持模块职责单一。

---

如果你接下来希望，我也可以根据这份拆分报告，直接把 `page-solution.php` 改造成使用 `get_template_part()` 的模块化结构（保持现有视觉完全一致的前提下），并为 `card-solution.php` / `card-product.php` 写出初始版本。

