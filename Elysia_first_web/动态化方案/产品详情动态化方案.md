# 产品详情动态化方案（仅使用 ACF 字段）

> 适用范围：  
> - 单品模板：`woocommerce/single-product.php`  
> - 模板片段目录：`template-parts/product_detail/` 下各文件  
> - WooCommerce + ACF（Advanced Custom Fields），不再依赖 EAEL 等内容类插件实现动态内容  

---

## 一、方案目标与现状

### 1.1 目标

- 保留当前页面整体结构与视觉布局（Elementor 导出的 HTML 为基础）。
- 将页面中的所有“写死”内容改为动态字段：
  - 标题 / 简介 / USP 图标区
  - FAQ 问答
  - Inquiry 区块（主区域 + 侧边卡片）
  - 相关产品列表
  - 图片画廊 / 详情内容区域
- 动态数据统一来源：ACF 字段 + WooCommerce 原生字段（标题、分类、评论等）。
- 不依赖除 WooCommerce、ACF 外的其他插件的动态能力（例如 EAEL 高级手风琴等）。

### 1.2 当前模板结构概览

- 单品入口：  
  [`single-product.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/woocommerce/single-product.php)
  - 左列：`template-parts/woocommerce/product-gallery.php`
  - 右列：`template-parts/product_detail/product-hero-summary.php`
  - 右列 USP/分享/CTA：`product-usp-icons.php`、share-buttons、product-top-cta
  - 下方内容区：
    - 左：`template-parts/woocommerce/product-tabs.php`、`product-faq.php`、`product-inquiry-section.php`
    - 右：目录 TOC、`product-sidebar-categories.php`、`product-sidebar-inquiry-card.php`
  - 页面底部：`product-related-products.php`

- 现状问题：
  - 多数内容完全硬编码在模板里，所有产品共用同一套文案/图片。
  - FAQ 使用 EAEL 的 HTML 结构，但数据同样写死。
  - 相关产品列表写死了具体产品链接与图片。
  - Product Gallery、Tabs 区域图片与文字全部写死。

---

## 二、整体思路

1. ACF 字段分组设计
   - 按功能区划分多个字段组，挂在产品（product）类型上：
     - 产品基础信息扩展（副标题、顶部摘要等）
     - USP 图标区（重复字段）
     - FAQ 列表（重复字段）
     - Inquiry 主区内容
     - 侧边 Inquiry 卡片内容
     - 可选：自定义画廊、详情内容、相关产品关系等

2. 模板读取逻辑
   - 在各模板片段中使用 `get_field()`、`have_rows()`、`get_sub_field()` 读取 ACF。
   - 保持现有 HTML 结构和 CSS class，尽量少改前端结构。
   - 无数据时合理回退：
     - 无 USP 列表时隐藏该区块。
     - 无 FAQ 时隐藏 FAQ 区块。
     - 无自定义相关产品时，回退到 WooCommerce 默认相关产品逻辑（可选）。

3. WooCommerce 原生数据与 ACF 的关系
   - 标题：使用 `the_title()` 或 `$product->get_name()`（不建议为标题单独建 ACF）。
   - 分类：使用 `wc_get_product_category_list()` 或 `get_the_terms()`。
   - 评论：使用 WooCommerce 原生评价机制（Reviews Tab）。
   - 其余所有营销文案/图片，使用 ACF 控制。

---

## 三、ACF 字段设计

### 3.1 字段组：产品基础信息扩展（Hero Summary）

字段组名称：Product Hero Summary  
绑定位置：Post Type = `product`

字段列表：

1. `product_subtitle`（文本）
   - 功能：产品副标题/一句话说明。
   - 用途：显示在主标题附近或者 Short Description 前。

2. `hero_short_description`（WYSIWYG）
   - 功能：顶部简短介绍，用于替换原 `product-hero-summary.php` 中两段写死文字。
   - 说明：若为空，回退到 WooCommerce 的短描述（excerpt）。

3. `hero_highlight_list`（Repeater）
   - 子字段：
     - `label`（文本，例如：`Material`）
     - `value`（文本，例如：`Galvanized Steel, 0.6–2.5mm`）
   - 用途：在 Hero 区块下展示 2–5 条关键参数/卖点。

说明：分类部分仍推荐优先使用产品实际分类，不用 ACF 再抄一份。

---

### 3.2 字段组：USP 图标区（product-usp-icons.php）

字段组名称：Product USP Icons  
绑定位置：Post Type = `product`

字段列表：

1. `usp_icons`（Repeater）
   - 子字段：
     - `icon_type`（Select）
       - 选项：`svg` / `image` / `icon_class`
     - `icon_svg`（Textarea）
       - 用途：直接粘贴 `<svg>...</svg>` 内容。
     - `icon_image`（Image）
       - 用途：上传图标图片。
     - `icon_class`（Text）
       - 用途：使用字体图标 class（例如 Font Awesome）。
     - `title`（Text）
       - 例如：`Global Service`
     - `description`（Text 或 Textarea）
       - 例如：`Our professional foreign traders will satisfy global businessman...`

渲染逻辑建议（简述）：

- 在 [`product-usp-icons.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-usp-icons.php) 中：
  - 保留外层 `<section>`、列布局结构。
  - 使用 `have_rows('usp_icons')` 循环生成每一个 icon-box。
  - 图标部分根据 `icon_type` 决定输出：
    - `svg`：直接输出 `icon_svg`；
    - `image`：输出 `<img src="...">`；
    - `icon_class`：输出 `<i class="..."></i>` 或 `<span class="..."></span>`。
  - 标题与描述分别输出 `title`、`description`。

---

### 3.3 字段组：FAQ 列表（product-faq.php）

字段组名称：Product FAQs  
绑定位置：Post Type = `product`

字段列表：

1. `faq_title`（Text）
   - 默认值：`FAQ`

2. `faq_items`（Repeater）
   - 子字段：
     - `question`（Text）
     - `answer`（WYSIWYG）

渲染逻辑建议：

- 对应文件：[`product-faq.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-faq.php)
- 现状：使用 EAEL 的手风琴 HTML 和写死的问题/答案。
- 目标：保持相似的 HTML 结构和 class，使现有样式可复用，但完全用 ACF 填充。

核心逻辑：

- 标题：输出 `faq_title`，为空则使用默认 `FAQ`。
- 若 `have_rows('faq_items')`：
  - 生成 `.eael-accordion-list` 列表，每条：
    - 标题区域输出 `question`
    - 内容区域输出 `answer`
- 若无 `faq_items`：
  - 整块 FAQ 区域不输出（避免空白）。

如果后续需要完全摆脱 EAEL 插件，可以自定义一段简易的 JS 来控制手风琴展开/收起，使用相同或简化的 class 名即可。

---

### 3.4 字段组：Inquiry 主区（product-inquiry-section.php）

字段组名称：Product Inquiry Section  
绑定位置：Post Type = `product`

字段列表：

1. `inquiry_section_title`（Text）
   - 默认值：`Inquiry`

2. `inquiry_section_intro`（Textarea 或 WYSIWYG）
   - 功能：主区域简单说明文字，例如“Please leave your inquiry here and we will reply soon.”

3. `inquiry_section_button_text`（Text）
   - 默认值：`Inquiry Now`

4. `inquiry_section_button_link`（URL / Page Link / Text）
   - 若继续使用弹窗，可保存为文本，例如 `#elementor-action:action=popup:open&settings=...`
   - 或改为普通链接，指向联系页面。

渲染位置说明：

- 模板文件：[`product-inquiry-section.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-inquiry-section.php)
- 当前只输出一个静态 `Inquiry` 标题，可扩展为：
  - 标题：`inquiry_section_title`
  - 正文 / 说明：`inquiry_section_intro`
  - 按钮文本与链接：使用上述字段构造 `<a>`。

---

### 3.5 字段组：侧边 Inquiry 卡片（product-sidebar-inquiry-card.php）

字段组名称：Product Sidebar Inquiry Card  
绑定位置：Post Type = `product`

字段列表：

1. `sidebar_inquiry_title`（Text）
   - 默认值：`Inquiry Now`

2. `sidebar_inquiry_text`（Textarea）
   - 如当前文案：`Any questions? Send us message now! ...`

3. `sidebar_inquiry_button_text`（Text）
   - 默认值：`Inquiry Now`

4. `sidebar_inquiry_button_link`（URL / Text）
   - 同样可用弹窗触发 URL 或普通链接。

5. `sidebar_inquiry_icon_svg`（Textarea，可选）
   - 可复用当前 SVG 图标，或者按产品定制。

渲染逻辑：

- 对应文件：[`product-sidebar-inquiry-card.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-sidebar-inquiry-card.php)
- 将：
  - `<h2>` 文本 → ACF 字段 `sidebar_inquiry_title`
  - `<p>` 文案 → `sidebar_inquiry_text`
  - 按钮文字、链接 → `sidebar_inquiry_button_text`、`sidebar_inquiry_button_link`
  - 如需自定义图标，则用 `sidebar_inquiry_icon_svg` 替换模板中写死的 SVG。

---

### 3.6 字段组：相关产品（product-related-products.php）

字段组名称：Product Related Products（手动关联）  
绑定位置：Post Type = `product`

字段列表：

1. `related_products`（Relationship）
   - 目标 Post Type：`product`
   - 允许多选，用于手工指定当前产品页面要展示的相关产品列表。

渲染逻辑建议：

- 对应文件：[`product-related-products.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-related-products.php)
- 现状：写死了 4 个产品卡片（图片、标题、链接等）。
- 目标：结构保持一致，但数据来源于 `related_products`：

基本步骤：

- 获取字段：`$related_products = get_field('related_products');`
- 若有值：
  - 遍历每个 `$related_product`（为 `WP_Post` 或产品 ID）：
    - 使用 WooCommerce API 获取产品名称、链接、主图：
      - 链接：`get_permalink( $related_product )`
      - 图片：`get_the_post_thumbnail( $related_product, 'woocommerce_thumbnail' )`
- 若无值：
  - 选项一：不显示“Related products”模块。
  - 选项二：回退到 WooCommerce 默认相关产品逻辑（`wc_get_related_products()`）。

---

### 3.7 字段组：产品详情内容与画廊（可选增强）

当前模板：

- 画廊：[`product-gallery.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/woocommerce/product-gallery.php) 完全写死为某个电缆梯产品的图片。
- Tabs：[`product-tabs.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/woocommerce/product-tabs.php) 中 Description 区域是固定的图片 + 说明 + 表格。

出于工作量和复用性考虑，这一块可以有两种方案。

#### 方案 A：优先使用 WooCommerce 原生字段

- 画廊：
  - 使用 WooCommerce 默认画廊模板（`woocommerce_show_product_images` 钩子），不额外做 ACF。
  - 若必须保留自定义结构，则在 `product-gallery.php` 中用 `$product->get_image_id()` 和 `$product->get_gallery_image_ids()` 输出图片。

- 详情 Tab：
  - Description Tab 内容改为输出 WooCommerce 产品的主内容：`the_content()`。
  - 产品参数表格、附加图片可放入产品内容中，使用 Gutenberg 或 经典编辑器编辑，而不是硬编码在模板里。

此方案虽然不是“全部依赖 ACF”，但对运营最简单，推荐作为默认方案。

#### 方案 B：通过 ACF 完全控制详情内容

如果希望所有内容均通过 ACF 控制，可设计以下字段组：

字段组名称：Product Detail Content  
绑定位置：Post Type = `product`

字段列表示例：

1. `detail_header_image`（Image）  
2. `detail_intro_text`（WYSIWYG）  
3. `detail_profile_drawings`（Gallery）  
4. `detail_production_line_images`（Gallery）  
5. `detail_details_image`（Image）  
6. `detail_parameter_table`（WYSIWYG 或 Flexible Content）  

渲染方式：

- 在 `product-tabs.php` 的 Description Tab 部分，将原所有写死的 `<img>`、`<p>`、`<table>` 替换为按上述字段动态输出。
- 可用简单的布局逻辑：若某字段为空，则跳过该模块。

---

### 3.8 侧边分类列表（product-sidebar-categories.php）

当前文件：  
[`product-sidebar-categories.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-sidebar-categories.php)

- 现状：列出若干产品分类链接，全部写死。
- 推荐方式：不使用 ACF，改为使用 WooCommerce 分类：
  - 调用 `get_terms( 'product_cat', ... )` 输出分类列表。
  - 或使用 `wp_list_categories()` 针对 `product_cat`。

由于分类本身就是动态数据，重复通过 ACF 再维护一遍意义不大。  
如果你希望人工控制显示顺序且只展示部分分类，也可以加一个 ACF 选项字段组（Option Page）维护一个分类列表（字段类型为 Taxonomy 或 Relationship 指向 `product_cat`），再在此模板中读取；但这属于站点级设置，不是单个产品字段。

---

## 四、ACF 后台配置步骤（操作指南）

以 WordPress 后台为例说明一次性配置流程：

1. 创建字段组：Product Hero Summary
   - 进入 ACF → 字段组 → 新增。
   - 添加字段：
     - `product_subtitle`（文本）
     - `hero_short_description`（WYSIWYG）
     - `hero_highlight_list`（Repeater：`label` + `value`）。
   - 位置规则：`Post Type` 等于 `product`。
   - 保存。

2. 创建字段组：Product USP Icons
   - 新建字段组。
   - 添加 `usp_icons` Repeater 及子字段。
   - 位置规则：继续绑定 `product`。

3. 创建字段组：Product FAQs
   - 新建字段组。
   - 添加：
     - `faq_title`（文本）
     - `faq_items` Repeater（`question` + `answer`）。
   - 位置规则：`product`。

4. 创建字段组：Product Inquiry Section
   - 新建字段组。
   - 添加前文列出的 4 个字段。
   - 位置规则：`product`。

5. 创建字段组：Product Sidebar Inquiry Card
   - 新建字段组。
   - 添加侧边卡片相关字段。
   - 位置规则：`product`。

6. 创建字段组：Product Related Products
   - 新建字段组。
   - 添加 `related_products` Relationship 字段。
   - 目标 Post Type 设为 `product`。
   - 位置规则：`product`。

7. （可选）创建字段组：Product Detail Content
   - 如需完全用 ACF 控制描述与参数内容，再按 3.7 的字段结构创建。

---

## 五、各模板文件改造要点（逻辑说明）

以下为逻辑层面的改造说明，不包含完整代码块，方便你在现有模板基础上逐步替换。

### 5.1 `single-product.php`

文件路径：  
[`single-product.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/woocommerce/single-product.php)

- 确保页面处于 WordPress Loop 内，并且 `$product` 为当前产品：
  - 通常写法为 `while ( have_posts() ) : the_post(); ... endwhile;`
- 本文件主要负责布局与 `get_template_part()` 调用，实际字段读取都在各 template part 中进行。
- 此文件不需要直接调用 ACF，只需保证上下文正确。

### 5.2 `product-hero-summary.php`

文件路径：  
[`product-hero-summary.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-hero-summary.php)

当前内容要点：

- `<h1>` 写死 `Cable Ladder Roll Forming Machine`
- 分类区域写死 3 个链接
- 简短说明写死为 2 段英文描述

改造要点：

- 标题：使用 `the_title()` 输出当前产品名称。
- 分类：
  - 使用 `wc_get_product_category_list( get_the_ID() )` 输出分类列表；
  - 或手工 `get_the_terms( get_the_ID(), 'product_cat' )` 遍历输出 `<a>`。
- 简短说明区域：
  - 优先使用 `hero_short_description`（ACF）。
  - 如为空，回落到 WooCommerce 短描述（`$product->get_short_description()`）。

可选扩展：

- 在标题下增加 `product_subtitle`。
- 使用 `hero_highlight_list` 输出一排关键参数信息。

### 5.3 `product-usp-icons.php`

文件路径：  
[`product-usp-icons.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-usp-icons.php)

改造要点：

- 保留外层 section/column 结构。
- 删除内部写死的 3 组 icon-box，将中间重复块用 `have_rows('usp_icons')` 循环生成。
- 根据字段的 `icon_type` 决定输出 `<svg>`、`<img>` 或 `<i class="...">`。

### 5.4 `product-faq.php`

文件路径：  
[`product-faq.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-faq.php)

改造要点：

- 标题 `<h3>` 文本改为输出 `faq_title`（无则使用默认“FAQ”）。
- 将所有固定的 `.eael-accordion-list` 删除，改成根据 `faq_items` Repeater 动态循环生成。
- ID、`data-tab` 序号可根据循环计数自动生成，保持结构类似即可。

### 5.5 `product-inquiry-section.php`

文件路径：  
[`product-inquiry-section.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-inquiry-section.php)

改造要点：

- 标题 `<h3>` 使用 `inquiry_section_title`。
- 如需扩展文本/按钮，可在此文件中加入对 `inquiry_section_intro` 与按钮字段的读取和输出。

### 5.6 `product-sidebar-categories.php`

文件路径：  
[`product-sidebar-categories.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-sidebar-categories.php)

改造要点：

- 将 `<ul>` 内所有写死的 `<li>` 删除。
- 使用 WooCommerce 分类动态输出：
  - 获取想展示的分类列表（按需要控制条数、层级）。
  - 按当前 HTML 结构输出 `<li><a href="...">分类名称</a></li>`。

这里不强制引入 ACF，因为分类本身是动态数据，重复维护会增加工作量。

### 5.7 `product-sidebar-inquiry-card.php`

文件路径：  
[`product-sidebar-inquiry-card.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-sidebar-inquiry-card.php)

改造要点：

- 标题：使用 `sidebar_inquiry_title`。
- 文案：使用 `sidebar_inquiry_text`。
- 按钮文本和链接：使用对应 ACF 字段。
- 图标 SVG 如需可配：优先读取 `sidebar_inquiry_icon_svg`，为空则使用当前默认 SVG。

### 5.8 `product-related-products.php`

文件路径：  
[`product-related-products.php`](file:///e:/phpstudy_pro/WWW/wp-content/themes/Elysia_first_web/template-parts/product_detail/product-related-products.php)

改造要点：

- 使用 Relationship 字段 `related_products` 替代当前所有写死的产品卡片。
- 列表结构仍使用 `<ul class="products elementor-grid columns-4">`，每个 `<li>` 内部内容使用 WooCommerce 的产品数据构建：
  - 链接：`get_permalink( $related_product )`
  - 图片：`get_the_post_thumbnail( $related_product, 'woocommerce_thumbnail' )`
  - 标题：`get_the_title( $related_product )`
- 如 `related_products` 为空：
  - 可选择隐藏整个 Section，或者回退到 `wc_get_related_products()` 逻辑。

### 5.9 `product-gallery.php` 与 `product-tabs.php`

这两个文件改造方案见 3.7 小节：

- 若采用 WooCommerce 原生字段方案：
  - `product-gallery.php` 建议直接调用 WooCommerce 原生画廊钩子或以 `$product->get_image_id()`、`$product->get_gallery_image_ids()` 为数据源重构。
  - `product-tabs.php` 的 Description 内容改为 `the_content()` 或某个 ACF WYSIWYG 字段。

- 若采用完全 ACF 化方案：
  - 按 3.7 中描述的字段结构，将各图片、段落、表格从模板中抽取到 ACF 字段，再在模板中逐字段输出。

---

## 六、数据迁移与上线建议

1. 字段组先行
   - 在测试环境中先完整创建所有字段组。
   - 为 1–2 个代表性产品手动填充所有 ACF 字段，预览确认布局无问题。

2. 模板分步改造
   - 推荐顺序：
     1. Hero Summary 区块
     2. USP Icons
     3. FAQ
     4. Inquiry（主区域 + 侧边卡片）
     5. 相关产品
     6. 画廊与 Tabs（视需要）

3. 回退策略
   - 每个模板片段在 ACF 字段为空时，应有合理回退：
     - 如无 FAQ，则不显示 FAQ 区块。
     - 如无相关产品，则隐藏或使用 Woo 默认算法。
     - 如无自定义详情内容，仍可显示原 `the_content()`。

4. 运营填写规范
   - 建议为运营整理一份简短说明：
     - 每个字段用途与展示位置截图。
     - 必填字段与可选字段说明。
   - 保证后续新增产品时，按照统一规范填写字段，即可自动生成完整的产品详情页。

