## 产品列表动态化方案

> 基于当前实现：
>
> - 模板入口：产品列表归档模板（例如 `archive-product.php` 或自定义页面模板）
> - 组成模块目录：`wp-content/themes/Elysia_first_web/template-parts/product/`

---

本版本假设站点已安装 Advanced Custom Fields（下文简称 ACF），并优先使用 ACF 字段统一管理所有可配置内容：

- 全局配置（如标题、介绍文案、PDF 链接、Why Sunway 统计数字等）推荐放在 ACF Options Page 中；
- 与分类 / 产品绑定的信息推荐通过对应的 ACF 字段组管理；
- 文中示例代码默认使用 `get_field()`、`have_rows()` 等 ACF API，可根据实际字段 key 做调整。

---

### 一、目标与范围

- 保持现有 Elementor 结构、类名和样式不变或尽量不变
- 将 **产品列表数据** 和 **关键文案 / 链接 / 统计数据** 动态化
- 基于统一的数据源输出产品列表（支持分页与结果数量统计）
- 仅调整当前产品归档页相关模板，不影响其它页面

---

### 二、当前结构概览

#### 1. 模板入口 `archive-product.php`

调用顺序如下：

```php
get_template_part('template-parts/product/archive', 'hero-title');
get_template_part('template-parts/product/archive', 'intro-cta-video');
get_template_part('template-parts/product/archive', 'product-grid');
get_template_part('template-parts/product/archive', 'c-purlin-faq');
get_template_part('template-parts/product/archive', 'factory-gallery');
get_template_part('template-parts/product/archive', 'why-sunway');
get_template_part('template-parts/product/archive', 'contact-us-cta');
```

- 当前模板未使用任何数据循环/查询 API
- 产品列表由 `archive-product-grid.php` 内部的静态 `<ul class="products ...">` 构造

#### 2. 各模块功能简述

- `archive-hero-title.php`  
  顶部 Hero，H1 标题固定为 “Electric & Energy”。

- `archive-intro-cta-video.php`  
  左边：标题 “Electric & Energy” + 两段介绍文案 + “CONTACT US” 按钮（Elementor 弹窗链接）+ “Download cataloge” PDF 下载链接。  
  右边：一个 Video Widget（目前为 YouTube 占位配置）。

- `archive-product-grid.php`  
  - 外层为 Elementor Section + Column + Widget 容器。
  - 内层 `<div class="woocommerce columns-4">` 里：
    - 调用了 `archive-woo-result-count.php`（但内部结果数目前是静态文本）。
    - `<ul class="products elementor-grid columns-4" data-products="type-1" data-hover="swap">` 中硬编码了多个 `<li class="product ...">`：
      - 图片 URL 为主题 `static/image/*.webp` 或 `.jpg`
      - 产品链接为固定 URL（部分为 `index-3.html`，部分指向 `https://swforming.com/product/...`）

- `archive-woo-result-count.php`  
  文本完全写死为 “Showing 1–16 of 83 results”。

- `archive-c-purlin-faq.php`  
  Elementor 手风琴 FAQ，内容是 C 型檩条成型机相关问题（英文，静态）。

- `archive-factory-gallery.php`  
  “Our Factory” 标题 + 静态三张工厂图片画廊，图片来自 `static/image/factory-0*.webp`。

- `archive-why-sunway.php`  
  “Why Sunway” 板块，包括：
  - 标题、副标题、介绍文案
  - 一组带 SVG 图标的优势列表（4 行）
  - 内嵌小 Section 展示 “100+ Destination Countries”、“500+ Finished Project” 等统计数字

- `archive-contact-us-cta.php`  
  “Contact Us Now” 标题 + Zoho 表单 iframe 脚本（formperma 固定为当前值）。

---

### 三、总体动态化原则

- **不改变页面结构与 CSS 类名**  
  所有 `.elementor-*`、`.woocommerce`、`.products` 等类尽量保留，仅替换内部动态内容。

- **产品数据统一从主查询或统一查询获取**  
  - 在产品网格模块中使用 `have_posts()` / `the_post()`，或自定义 `WP_Query` 循环获取产品数据。
  - 不再硬编码具体产品 `<li>` 项。

- **可配置文案、链接与统计数字**  
  - 推荐使用 ACF Options Page 建立统一的“产品归档设置”字段组，集中存放：
    - Hero 标题（或标题前后缀）
    - 产品类别介绍文案
    - CTA 按钮文字与链接
    - PDF 下载链接
    - 工厂图集图片列表
    - “Why Sunway” 文案与数字
    - Zoho 表单 ID / 脚本片段
  - 如暂不使用 Options Page，也可以将这些字段挂载在固定页面 / 自定义设置 Post 上，再通过 `get_field()` 读取。
  - 仅在极简场景下使用 `get_option()` / term meta / post meta 作为补充。

- **尽量兼容多语言与 SEO**  
  - H1 标题优先考虑使用 WordPress 提供的归档标题（如分类名）。
  - 不直接写死英文文案，而从配置中读取。

---

### 四、各模块动态化方案

#### 4.1 `archive-hero-title.php`（Hero 标题）

**当前：**

```html
<h1 class="elementor-heading-title elementor-size-default">Electric &amp; Energy</h1>
```

**动态化方案：**

- 标题来源：
  - 若是某个产品分类归档：使用当前分类名称，例如：
    - `single_term_title()` 或 `get_queried_object()->name`
  - 若是产品列表主归档：使用 `post_type_archive_title()` 或 `get_the_archive_title()`。
- 逻辑建议：
  - 在 `archive-hero-title.php` 中用 PHP 输出标题文本：
    - 判断 `is_post_type_archive('product')` 或对应自定义文章类型；如有分类再判断 `is_tax()`。
    - 默认 fallback 到 `get_the_archive_title()`。
- 样式保持：
  - 仍然输出 `<h1 class="elementor-heading-title elementor-size-default">` 包裹动态标题。

#### 4.2 `archive-intro-cta-video.php`（介绍 + CTA + 视频）

**静态内容：**

- 标题再次写死为 “Electric & Energy”
- 两段产品线介绍文案
- “CONTACT US” 按钮：Elementor 弹窗链接（固定 action URL）
- “Download cataloge”：固定 PDF URL（指向 `swforming.com`）
- 视频 widget：`data-settings` 中固定了 `youtube_url` 等

**动态化方案：**

1. **标题动态化：**
   - 与 Hero 标题保持一致逻辑，使用同一数据源（归档标题）。
   - 如需与 H1 不同，可在 ACF Options Page 中增加单独字段，例如：
     - `elysia_product_archive_subtitle`（文本字段）。

2. **介绍文案配置化：**
   - 在 ACF Options Page 中增加两个文本字段，例如：
     - `elysia_product_archive_intro_paragraph_1`
     - `elysia_product_archive_intro_paragraph_2`
   - 模板中使用 ACF 读取并输出，例如：

     ```php
     <p>
         <?php echo esc_html( get_field( 'elysia_product_archive_intro_paragraph_1', 'option' ) ?: '静态默认文案 1' ); ?>
     </p>
     <p>
         <?php echo esc_html( get_field( 'elysia_product_archive_intro_paragraph_2', 'option' ) ?: '静态默认文案 2' ); ?>
     </p>
     ```

   - 字段为空时可继续 fallback 到当前静态默认文案，保证初次部署也正常显示。

3. **CTA 按钮：**
   - 按钮文字：
     - 在 Options Page 中配置字段 `elysia_product_archive_cta_label`（默认 “CONTACT US”）。
   - 按钮链接：
     - 若继续使用 Elementor 弹窗机制，可以：
       - 在 Options Page 中定义一个文本字段 `elysia_product_archive_cta_action_url` 存储 action URL；
       - 模板中直接输出该值到 `href` 或 `data-*` 中。
     - 若改为固定页面/表单页面：
       - 在 Options Page 中保存一个“联系页面”字段（Post Object 或 Page ID）；
       - 模板中通过 `get_field( 'elysia_product_archive_cta_page', 'option' )` 取得页面，再用 `get_permalink()` 输出链接。

4. **PDF 下载链接：**
   - 将当前 PDF 地址抽象为配置项，例如：
     - 在 Options Page 中定义 `elysia_product_archive_catalog_url`（URL 字段），或 `elysia_product_archive_catalog_file`（File 字段）。
   - 模板中通过 `get_field()` 输出：
     - 若是 File 字段，可先取附件 ID，再用 `wp_get_attachment_url()` 获取真实地址。

5. **视频配置：**
   - 将 `youtube_url` 抽象为配置项，如：
     - 在 Options Page 中定义 `elysia_product_archive_video_url`（URL 字段）。
   - 模板中使用 `get_field( 'elysia_product_archive_video_url', 'option' )` 替换 `data-settings` 中的 URL，保持其他属性不变（如 `controls`、`show_image_overlay` 等）。

#### 4.3 `archive-product-grid.php`（产品列表网格）

**当前：**

- 调用 `archive-woo-result-count.php`（但结果数为静态文本）。
- `<ul class="products elementor-grid columns-4" data-products="type-1" data-hover="swap">` 内部完全是硬编码产品 `<li>`：
  - 图片来自主题 `/static/image/`
  - 链接多数指向原站 `https://swforming.com/product/...` 或本地 `index-3.html`

**核心问题：**

- 没有使用任何动态查询/循环，新增产品不会自动显示。
- 结果数、分页等功能无法根据实际产品数量自动更新。

**动态化方案：**

1. **使用统一的产品查询循环输出 `<li>`：**

   在保持外围 Elementor + `.woocommerce` 容器及 `<ul>` 类名结构不变的前提下，将 `<ul>` 中的内容改为：

   - 使用主查询（归档页）或自定义 `WP_Query` 循环，例如伪代码：

     ```php
     <?php
     $query = $wp_query;
     // 如需单独控制，可改用 new WP_Query([...])
     if ( $query->have_posts() ) :
         while ( $query->have_posts() ) : $query->the_post(); ?>
             <li class="product elementor-grid-item">
                 <a href="<?php the_permalink(); ?>">
                     <!-- 此处输出主图、标题等 -->
                 </a>
             </li>
         <?php endwhile;
         wp_reset_postdata();
     else : ?>
         <li class="product no-results">No products found</li>
     <?php endif; ?>
     ```

   - 如需完全控制 HTML，可在 `<li>` 中根据需要输出：
     - 产品链接：`the_permalink()`
     - 产品标题：`the_title()`
     - 产品主图：`get_the_post_thumbnail_url()` 或 `the_post_thumbnail()`
     - 价格、型号等：使用 `get_field()` / `get_post_meta()` 获取 ACF 字段（如价格、型号、短描述等）。

2. **保留 hover 双图效果：**

   当前每个 `<li>` 中有两张图片（`.ct-swap` + 主图），用于 hover 切换：

   - 方案 A：利用产品画廊图片：
     - 第一张：产品特色图（主图）
     - 第二张：画廊中的第一张附图（若存在）。
   - 方案 B：为每个产品增加两个自定义字段（或使用产品画廊），模板中按字段输出。

   设计层面建议使用产品画廊图片，更符合电商类站点习惯。

3. **分页与排序：**

   - 使用 `paginate_links()` 或 `the_posts_pagination()` 输出分页：
     - 在合适位置（`<ul>` 外部或下方）调用。
   - 如需排序或筛选，可通过 `pre_get_posts` 或自定义 `WP_Query` 的参数控制（如按分类、价格区间等）。

4. **与 `archive-woo-result-count.php` 协调：**

   - 结果数量不再硬编码，详见下一小节。

#### 4.4 `archive-woo-result-count.php`（结果数量）

**当前：**

```html
<p class="woocommerce-result-count ct-hidden-sm" role="alert" aria-relevant="all">
    Showing 1&ndash;16 of 83 results
</p>
```

**动态化方案：**

- 使用当前查询对象 `$wp_query` 计算结果数量并输出结构：

  ```php
  <?php
  global $wp_query;
  $total    = (int) $wp_query->found_posts;
  $per_page = (int) $wp_query->get( 'posts_per_page' );
  $paged    = max( 1, (int) get_query_var( 'paged', 1 ) );
  $from     = $total ? ( $per_page * ( $paged - 1 ) + 1 ) : 0;
  $to       = min( $total, $per_page * $paged );
  ?>
  <p class="woocommerce-result-count ct-hidden-sm" role="alert" aria-relevant="all">
      Showing <?php echo $from; ?>&ndash;<?php echo $to; ?> of <?php echo $total; ?> results
  </p>
  ```

- 样式保持：
  - 保留 `.woocommerce-result-count ct-hidden-sm` 类名，确保与现有 CSS 兼容。

#### 4.5 `archive-c-purlin-faq.php`（FAQ 手风琴）

**当前：**

- 针对 C Purlin Roll Forming Machine 的英文 FAQ，纯静态 HTML，使用 EAEL Advanced Accordion 结构。

**动态化方案（两种级别）：**

1. **简单方案（短期）：**
   - 保持 FAQ 内容静态，不做动态数据接入。
   - 仅在需要时通过后台编辑模板文件更新文案。

2. **完整方案（长期，推荐使用 ACF）：**
   - 新建 FAQ 数据源：
     - 方案 A（推荐）：在当前产品分类或某个全局 Options 上绑定 ACF Repeater 字段（每行包含“问题 + 答案”）。
     - 方案 B：当 FAQ 内容规模较大、复用场景复杂时，再考虑自定义文章类型 `faq` + 分类（如 `faq_category`），并用 ACF 字段补充额外信息。
   - 在模板中：
     - 使用 `have_rows()` / `the_row()` 循环 Repeater 字段，生成每个问答条目；
     - 输出结构保持与当前 EAEL Accordion 相同，只替换内部文案。

> 由于该 FAQ 与具体场景强绑定，是否动态化可根据后续 FAQ 数量与维护频率决定。

#### 4.6 `archive-factory-gallery.php`（工厂图集）

**当前：**

- 标题 “Our Factory”
- 三张图片，路径固定为主题 `static/image/factory-01/02/03.webp`。

**动态化方案：**

- 新增一个配置项来维护工厂图集图片列表（推荐使用 ACF）：
  - 方案 A（推荐）：在 ACF Options Page 中定义 Gallery 字段 `elysia_factory_gallery_images`，统一返回一个图片数组。
  - 方案 B：如不使用 Gallery，可在 Options Page 中配置多个 Image 字段（image ID），在模板中手动组合成数组。
- 模板中：
  - 循环图片数组，生成 `<figure class='gallery-item'>` 结构。
  - 大图链接与 `<img>` srcset 可基于附件 ID 使用 `wp_get_attachment_image_src()` / `wp_get_attachment_image()` 生成。
- 标题 “Our Factory”：
  - 视需求决定是否配置化，建议在 Options Page 中添加文本字段 `elysia_factory_gallery_title`，默认当前文案。

#### 4.7 `archive-why-sunway.php`（Why Sunway）

**当前：**

- 标题 “Why Sunway”
- 副标题 “The Global Leader In Roll forming Industry”
- 一段较长的介绍文案
- 4 条优势项（带 SVG 图标 + 文本）
- 右侧 2 个统计数字模块（100+ Destination Countries、500+ Finished Project），数值和描述固定。

**动态化方案：**

- 文案与数字全部配置化：
  - 标题、副标题、介绍（1 个长文本）：
    - 在 ACF Options Page 中定义：
      - `elysia_why_sunway_title`
      - `elysia_why_sunway_subtitle`
      - `elysia_why_sunway_intro`
  - 优势列表（建议用 ACF Repeater 配置）：
    - 每项包含：标题文本（如 “We Use Advance Manufacturing Process”）、子描述（如有）。
  - 统计数字：
    - 例如，在同一 Options Page 字段组中添加：
      - `elysia_why_sunway_stat_1_number` / `elysia_why_sunway_stat_1_label`
      - `elysia_why_sunway_stat_2_number` / `elysia_why_sunway_stat_2_label`

- 图标 SVG：
  - 由于图标较标准且与文案关系不大，可先保持静态不动，仅用配置更改文本。
  - 若未来需要灵活替换图标，再考虑使用图标库或上传 SVG 的选项。

#### 4.8 `archive-contact-us-cta.php`（Zoho 联系表单）

**当前：**

- 标题 “Contact Us Now”
- 内嵌 Zoho Public Form 脚本，Form ID 固定为 `pzNRX0a0vTLnd9POzzlI5FD2DQm4WX5_ZfrCo5BuWow`。

**动态化方案：**

1. **标题配置化：**
   - `elysia_product_archive_contact_title`（默认 “Contact Us Now”）。

2. **表单配置化：**

   - 将 Zoho 相关参数抽象成 ACF 配置项，例如在 Options Page 中定义：
     - `elysia_zoho_form_perma` — formperma ID（文本字段）
     - `elysia_zoho_form_iframe_height` — 默认高度（数字字段）
   - 或者提供一个“联系表单短代码”字段：
     - 如 `elysia_contact_form_shortcode`，后台配置 `[contact-form-7 id="..."]` 或 `[zoho-form id="..."]`。
     - 模板中调用 `echo do_shortcode( get_field( 'elysia_contact_form_shortcode', 'option' ) );` 输出。

---

### 五、URL 与资源动态化建议

1. **产品链接：**
   - 产品列表改用统一的查询循环后，链接统一来自 `the_permalink()`，不再依赖 `swforming.com` 外链或 `index-3.html`。
   - 若某些产品需要指向外部 URL，可通过自定义字段存储外链地址，在模板中优先输出该外链。

2. **静态图片：**
   - 产品图片：使用文章/产品的特色图 + 画廊图替代主题 `static/image`。
   - 工厂图集：改用媒体库附件。

3. **PDF 目录：**
   - 不再写死 `https://swforming.com/...Sunway-Product-Catalog.pdf`，使用主题选项指定 PDF 附件 ID/URL。

---

### 六、实施步骤与优先级建议

1. **优先级 1：接入统一的产品查询循环**
   - 在 `archive-product-grid.php` 中接入主查询或自定义 `WP_Query` 循环，替换硬编码 `<li>`。
   - 确保分页、查询参数（分类、筛选等）生效。

2. **优先级 2：动态结果数量**
   - 修改 `archive-woo-result-count.php`，使用 `$wp_query` 自定义计算逻辑输出结果数量。

3. **优先级 3：标题与介绍文案配置化**
   - Hero 标题与 Intro 模块标题/文案在后台可配置，并优先使用归档标题。
   - 同时处理 CTA 按钮与 PDF 链接。

4. **优先级 4：工厂图集与 Why Sunway 模块配置化**
   - 建立图集与文案、数字的后台设置项。
   - 修改对应模板从配置中读取。

5. **优先级 5：联系表单模块抽象**
   - 为 Zoho 表单提供可替换的配置（ID 或短代码），避免代码层面硬编码。

6. **优先级 6：FAQ 动态化（可选）**
   - 若 FAQ 需要频繁维护，再引入 FAQ 数据源与动态渲染。
   - 否则短期内保持静态内容。

---

### 七、与现有代码的兼容性说明

- `archive-product.php` 可以继续作为布局入口，仅通过下级模板引入动态逻辑，无需大改。
- 所有动态化均在各 `archive-*.php` 模板内部实现，保持与 Elementor 导出的 HTML 兼容。
- 若后续需要与后台“自定义器”或某个设置页面集成，只需在上述方案中选择具体实现方式（`get_option`、ACF Options、主题设置页面等），不影响整体结构设计。

---

### 八、字段实现与 ACF 使用说明

- 本方案以 ACF 为主要字段管理方式，但对「字段如何存储」不做强制约束，只要求这些信息可在后台维护：
  - 页面文案（标题、副标题、介绍段落）
  - CTA 按钮文字与链接
  - PDF 目录链接
  - 工厂图集图片列表
  - Why Sunway 的文案与统计数字
  - 联系表单相关参数（如 Zoho 表单 ID 或短代码）
- 推荐的几种实现方式：
  - 优先使用 ACF Options Page、字段组、Gallery、Repeater 等字段来管理全局与模块配置；
  - 在分类 / 具体产品上绑定 ACF 字段组，存储与该分类 / 产品强相关的信息；
  - 在少量需要时，仍可以使用原生 `get_option()` / term meta / post meta 作为补充。
- 是否使用 ACF 完全可选：
  - 未安装 ACF 时，可全部用原生 Options / meta 实现；
  - 安装 ACF 后，可用 ACF 提供的 UI 提升配置体验，但不会改变本方案整体结构与逻辑。

